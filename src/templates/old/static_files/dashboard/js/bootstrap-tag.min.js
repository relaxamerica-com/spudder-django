!function(e){"use strict";var t=function(t,n){this.element=e(t);this.options=e.extend(true,{},e.fn.tag.defaults,n);this.values=e.grep(e.map(this.element.val().split(","),e.trim),function(e){return e.length>0});this.show()};t.prototype={constructor:t,show:function(){var t=this;t.element.parent().prepend(t.element.detach().attr("type","hidden"));t.element.wrap(e('<div class="tags">')).parent().on("click",function(){t.input.focus()});if(t.values.length){e.each(t.values,function(){t.createBadge(this)})}t.input=e('<input type="text">').attr("placeholder",t.options.placeholder).attr("tabindex",t.options.tabindex).attr("name",t.options.name).insertAfter(t.element).on("focus",function(){t.element.parent().addClass("tags-hover")}).on("blur",function(){if(!t.skip){t.process();t.element.parent().removeClass("tags-hover");t.element.siblings(".tag").removeClass("tag-important")}t.skip=false}).on("keydown",function(n){if(n.keyCode==188||n.keyCode==13||n.keyCode==9){if(e.trim(e(this).val())&&(!t.element.siblings(".typeahead").length||t.element.siblings(".typeahead").is(":hidden"))){if(n.keyCode!=9)n.preventDefault();t.process()}else if(n.keyCode==188){if(!t.element.siblings(".typeahead").length||t.element.siblings(".typeahead").is(":hidden")){n.preventDefault()}else{t.input.data("typeahead").select();n.stopPropagation();n.preventDefault()}}}else if(!e.trim(e(this).val())&&n.keyCode==8){var r=t.element.siblings(".tag").length;if(r){var i=t.element.siblings(".tag:eq("+(r-1)+")");if(i.hasClass("tag-important"))t.remove(r-1);else i.addClass("tag-important")}}else{t.element.siblings(".tag").removeClass("tag-important")}}).typeahead({source:t.options.source,matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())&&(t.inValues(e)==-1||t.options.allowDuplicates)},updater:e.proxy(t.add,t)});e(t.input.data("typeahead").$menu).on("mousedown",function(){t.skip=true})},inValues:function(t){if(this.options.caseInsensitive){var n=-1;e.each(this.values,function(e,r){if(r.toLowerCase()==t.toLowerCase()){n=e;return false}});return n}else{return e.inArray(t,this.values)}},createBadge:function(t){var n=this;e('<span class="tag">').text(t).append(e('<button type="button" class="close">&times;</button>').on("click",function(){n.remove(n.element.siblings(".tag").index(e(this).closest(".tag")))})).insertBefore(n.element)},add:function(t){var n=this;if(!n.options.allowDuplicates){var r=n.inValues(t);if(r!=-1){var i=n.element.siblings(".tag:eq("+r+")");i.addClass("tag-warning");setTimeout(function(){e(i).removeClass("tag-warning")},500);return}}this.values.push(t);this.createBadge(t);this.element.val(this.values.join(", "))},remove:function(e){if(e>=0){this.values.splice(e,1);this.element.siblings(".tag:eq("+e+")").remove();this.element.val(this.values.join(", "))}},process:function(){var t=e.grep(e.map(this.input.val().split(","),e.trim),function(e){return e.length>0}),n=this;e.each(t,function(){n.add(this)});this.input.val("")},skip:false};var n=e.fn.tag;e.fn.tag=function(n){return this.each(function(){var r=e(this),i=r.data("tag"),s=typeof n=="object"&&n;if(!i)r.data("tag",i=new t(this,s));if(typeof n=="string")i[n]()})};e.fn.tag.defaults={allowDuplicates:false,caseInsensitive:true,placeholder:"",source:[]};e.fn.tag.Constructor=t;e.fn.tag.noConflict=function(){e.fn.tag=n;return this};e(window).on("load",function(){e('[data-provide="tag"]').each(function(){var t=e(this);if(t.data("tag"))return;t.tag(t.data())})})}(window.jQuery)