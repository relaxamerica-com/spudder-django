{% extends 'CERN/single_well_base.html' %}

{% load accounts %}
{% load CERN %}

{% block title %}Register: {{ school.name }} - CERN | Spudder - Sports Updates Made Simple{% endblock %}

{% block well_content %}
		<h4 class="aligncenter">
            Join CERN Team for: <br/>
            <b>{{ school.name }}</b>
        </h4>
        <p>Use the button below to login using your amazon account and join this CERN team.</p>

        {% if referrer %}
            <p>You were referred by:</p>
            <p><label>
                {% user_name referrer.user %},
                {% if referrer.isHead %}
                Team Captain for
                {% else %}
                on the team for
                {% endif %}
                {{ referrer.school.name }}
                </label></p>
        {% endif %}

        {% if request.user.is_authenticated %}

            {% if request.user|is_student %}
                <div class="alert alert-danger">
                    <p>Uhoh! You've already joined a CERN team - you can only be on one team!</p>
                    <p>Go back to your <a href="/cern/">dashboard</a></p>
                </div>
            {% else %}
                <p><a href="/cern/join_school/{{ school.id }}/{{ referrer.id }}" class="btn btn-orange aligncenter">Join team with Existing Account</a></p>
            {% endif %}

        {% else %}

            <div class="alert alert-info">
                <h4><i class="icon-question-sign"></i> Why Amazon</h4>
                <p>CERN aims to get you <b>paid</b>!</p>
                <p>For this to happen, you need to have an amazon account.</p>
                <p><small>If you do not already have an Amazon account, you can create one by hitting the 'login win amazon' button.</small></p>
            </div>

            <div class="accounts-form-body">
                <form class="form-horizontal" action="/accounts/login" id="registration-form" method="POST">
                    {% if error %}
                    <div class="alert alert-error"><%= error %></div>
                    {% endif %}

                    <div class="control-group">
                        <p class="aligncenter">
                            <a href="#" id="LoginWithAmazon">
                                <img border="0" alt="Login with Amazon"
                                     src="https://images-na.ssl-images-amazon.com/images/G/01/lwa/btnLWA_gold_156x32.png"
                                     width="156" height="32" />
                            </a>
                        </p>
                    </div>
                </form>

        {% endif %}
        <p>Not your team? Click <a href="/cern/register/{{ referrer.id }}">here</a>.</p>
      </div>
{% endblock %}

{% block scripts %}
    <script type="text/javascript" language="javascript">

        var loginWithAmazon = document.getElementById('LoginWithAmazon'),
            returnUrl = '{{ request.META_HEADER.HTTP_HOST }}/accounts/login/amazon';

        returnUrl += '?school_id={{ school.id }}&next=/cern/{{ school.state }}/{{ school.id }}/{% strip_school_name school %}/';
        {% if referrer %}
            returnUrl += '&referrer=' + {{ referrer.id }};
        {% endif %}


        if (loginWithAmazon) {
            loginWithAmazon.onclick = function() {
                options = { scope : 'profile' };
                amazon.Login.authorize(options, returnUrl);
                return false;
            };
        }
    </script>
{% endblock %}