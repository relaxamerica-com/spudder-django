{% extends 'CERN/base.html' %}

{% load accounts %}
{% load CERN %}

{% block meta %}
    <title>Register: {{ school.name }} - CERN | Spudder - Sports Updates Made Simple</title>
{% endblock %}

{% block content %}
<div class="container clearfix" id="venue-account">
	<div class="well">
		<h4 class="aligncenter">Join CERN Team for
            {% if referrer %}
            <a href="/cern/{{ school.state }}/{{ school.id }}/{% strip_school_name school %}/{{ referrer.referral_code }}">{{ school.name }}</a>
            {% else %}
            <a href="/cern/{{ school.state }}/{{ school.id }}/{% strip_school_name school %}">{{ school.name }}</a>
            {% endif %}
        </h4>
        <h6>Simply use the button below to join this CERN team.</h6>

        {% if referrer %}
            <p>You were referred by:</p>
            <p><label>
                {% user_name referrer.user %},
                {% if referrer.isHead %}
                Team Captain for
                {% else %}
                on the team for
                {% endif %}
                {{ referrer.school.name }}
                </label></p>
        {% endif %}

        {% if request.user.is_authenticated %}
            {% if request.user|is_student %}
                <p>Uhoh! You've already joined a CERN team - you can only be on one team!</p>
            {% else %}
            <p><a href="/cern/join_school/{{ school.id }}/{{ referrer.id }}" class="btn btn-orange aligncenter">Join team with Existing Account</a></p>
            {% endif %}
        {% else %}
            <p>If you do not already have an Amazon account, you can also use this button to sign in.</p>

            <div class="accounts-form-body">
                <form class="form-horizontal" action="/accounts/login" id="registration-form" method="POST">
                    {% if error %}
                    <div class="alert alert-error"><%= error %></div>
                    {% endif %}

                    <div class="control-group">
                        <p class="aligncenter">
                            <a href="#" id="LoginWithAmazon">
                                <img border="0" alt="Login with Amazon"
                                     src="https://images-na.ssl-images-amazon.com/images/G/01/lwa/btnLWA_gold_156x32.png"
                                     width="156" height="32" />
                            </a>
                        </p>
                    </div>
                </form>

        {% endif %}
        <p>Not your team? Click <a href="/cern/register/">here</a>.</p>
      </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    var loginWithAmazon = document.getElementById('LoginWithAmazon'),
        returnUrl = '{{ request.META_HEADER.HTTP_HOST }}/accounts/login/amazon';

    returnUrl += '?school_id={{ school.id }}&next=/cern/{{ school.state }}/{{ school.id }}/{% strip_school_name school %}/';
    {% if referrer %}
        returnUrl += '&referrer=' + {{ referrer.id }};
    {% endif %}


    if (loginWithAmazon) {
        loginWithAmazon.onclick = function() {
            options = { scope : 'profile' };
            amazon.Login.authorize(options, returnUrl);
            return false;
        };
    }
</script>
{% endblock %}