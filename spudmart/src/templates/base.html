{% load bootstrap3 %}
{% load spudderaccountstags %}
{% load CERN %}
{% load featuretags %}

<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>{% block title %}{% endblock %}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        {% block meta %}
            <!-- Base facebook meta tags -->
            <meta property="og:url" content="http://{{ request.META.HTTP_HOST }}{{ request.path }}">
            <meta property="og:site_name" content="Spudder - Sports Updates Made Simple">
            <meta property="og:type" content="website">
            <!-- Twitter meta tags -->
            <meta property="twitter:card" content="summary">
            <meta property="twitter:site" content="@spudder_com">
        {% endblock %}
        {% block css %}{% endblock %}
        <link rel="shortcut icon" href={% block favicon %}"/static/img/spudderspuds/button-spuds-tiny.png"{% endblock %} />
        <link rel="stylesheet" href="/static/css/select2.css">
        <script src="/static/js/libs/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script type="text/javascript" language="javascript" src="/static/js/libs/jquery-1.11.0.min.js"></script>
        <script type="text/javascript" language="javascript" src="/static/js/libs/bootstrap.min.js"></script>
        <script type="text/javascript" language="javascript" src="/static/js/libs/jquery.livequery.js"></script>
        <script type="text/javascript" src="/static/js/alerts.js"></script>
    </head>
    <body class="{% block body_class %}{% endblock %}" id="{% block body_id %}{% endblock %}">
        {% block flag-modal %}{% endblock %}
        {% block header %}
            <nav class="navbar navbar-masthead navbar-default navbar-static-top" role="navigation">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        {% block nav_brand %}<a href="/"><img src="/static/img/spudderspuds/logo-spuds-small.png" style="height:35px;margin-top:2px;"/> </a>{% endblock %}
                    </div>
                    {% block masterhead %}{% endblock %}

                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav navbar-right">
                            {% block nav %}{% endblock %}
                            {% block current_role_nav %}
                                {% if current_role %}
                                    {% if current_role|is_cern_student %}
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                                                CERN Menu <i class="fa fa-caret-down"></i>
                                            </a>
                                            <ul class="dropdown-menu">
                                                <li><a href="/cern/"><i class="fa fa-fw fa-bar-chart-o"></i> Scoreboard</a></li>
                                                <li><a href="{% current_student_page %}"><i class="fa fa-fw fa-user"></i> Student Page</a></li>
                                                <li><a href="/cern/venues/"><i class="fa fa-fw fa-map-marker"></i> Venues</a></li>
                                                <li><a href="/team/list"><i class="fa fa-fw fa-group"></i> My Teams</a></li>
                                                <li><a href="/cern/social_media/"><i class="fa fa-fw fa-rss"></i> Social Media</a></li>
                                                <li><a href="/cern/testing/"><i class="fa fa-fw fa-bug"></i> QA Testing</a></li>
                                            </ul>
                                        </li>
                                    {% endif %}
                                    {% if current_role|is_sponsor %}
                                        {% include 'spuddersponsors/parts/sponsors_menu.html' %}
                                    {% endif %}
                                    {% if current_role|is_fan %}
                                        {% include 'spudderspuds/components/main_nav.html' %}
                                    {% endif %}
                                {% endif %}
                            {% endblock %}
                            {% block user_account_nav %}
                                {% if current_role %}
                                    <li class="dropdown">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                            My roles <i class="fa fa-caret-down"></i>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li style=" padding: 5px 30px; min-width: 350px;">
                                                <div class="panel panel-default">
                                                    <div class="panel-body">
                                                        <div class="media">
                                                            <a href="{{ current_role.home_page_path }}" class="media-object pull-left">
                                                                <img src="{{ current_role.image }}" style="height: 40px;" />
                                                            </a>
                                                            <div class="media-body">
                                                                <p class="media-heading">{{ current_role.title|safe }}</p>
                                                                <span class="label label-success"><a href="{{ current_role.home_page_path }}" style="color:white;">Current role</a></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% if other_roles %}
                                                    <hr />
                                                    <p>My {% if other_roles|length > 2 %}top{% else %}other{% endif %} role{% if other_roles|length > 1 %}s{% endif %}</p>
                                                    <div style="margin-left:10px;">
                                                        {% for role in other_roles %}
                                                            {% if forloop.counter < 3 %}
                                                                <hr />
                                                                <div class="media">
                                                                    <img class="media-object pull-left" src="{{ role.image }}" style="height: 40px;" />
                                                                    <div class="media-body">
                                                                        <p class="media-heading"><small>{{ role.title|safe }}</small></p>
                                                                        <a href="{% link_to_change_role_and_return role %}" class="btn btn-default btn-xs" style="margin:0;">
                                                                            Activate this role
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </div>
{#                                                    <hr />#}
{#                                                    <div class="btn-group">#}
{#                                                        <a class="btn btn-primary btn-sm" href="/users/roles/add">#}
{#                                                            <i class="fa fa-plus"></i> Add a new role#}
{#                                                        </a>#}
{#                                                        <a class="btn btn-default btn-sm" href="/users">#}
{#                                                            Manage your account#}
{#                                                        </a>#}
{#                                                    </div>#}
                                                {% else %}
{#                                                    <div class="btn-group">#}
{#                                                        <a class="btn btn-primary btn-sm" href="/users/roles/add">#}
{#                                                            <i class="fa fa-plus"></i> Add a new role#}
{#                                                        </a>#}
{#                                                        <a class="btn btn-default btn-sm" href="/users">#}
{#                                                            Manage your account#}
{#                                                        </a>#}
{#                                                    </div>#}
                                                {% endif %}
                                            </li>
                                            <li><a href="/accounts/logout?next={% block logout_next_url %}/{% endblock %}"><i class="fa fa-fw fa-power-off"></i> Logout</a></li>
                                        </ul>
                                    </li>
                                    {% block support_nav %}
                                        {% if current_role %}
                                            <li class="dropdown">
                                                <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                                                    Support <i class="fa fa-caret-down"></i>
                                                </a>
                                                <ul class="dropdown-menu">
                                                    <li><a href="http://spudder.zendesk.com/account/dropboxes/20176994" onClick="Zenbox.show(); return false;">Contact Spudder Support</a></li>
                                                    <li><a href="#" data-toggle="modal" data-target="#flag-modal" class="{% block flag-page-class %}hidden{% endblock %}">Flag Page</a></li>
                                                </ul>
                                            </li>
                                        {% endif %}
                                    {% endblock %}
                                    <li class="dropdown">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                            <i class="fa fa-share-alt"></i> <i class="fa fa-caret-down"></i>
                                        </a>
                                        <ul class="dropdown-menu" style="min-width: 1px">
                                            <li>
                                                <a data-original-title="Share on Facebook" data-placement="bottom" href="JavaScript:facebookPopup()">
                                                    <i class="fa fa-facebook-square fa-2x"></i>
                                                </a>
                                            </li>
                                            <li>
                                                <a data-original-title="Share on Twitter" data-placement="bottom" href="javascript:twitterPopup()">
                                                    <i class="fa fa-twitter-square fa-2x"></i>
                                                </a>
                                            </li>
                                            <li>
                                                <a data-original-title="Share on LinkedIn" data-placement="bottom"href="Javascript:linkedinPopup()">
                                                    <i class="fa fa-linkedin-square fa-2x"></i>
                                                </a>
                                            </li>
                                            <li>
                                                <a data-original-title="Share on Google+" data-placement="bottom" href="javascript:googlePopup()">
                                                    <i class="fa fa-google-plus-square fa-2x"></i>
                                                </a>
                                            </li>
                                            <li>
                                                <a data-original-title="Share via Email" data-placement="bottom" id="mailto" href="mailto:?subject=Check out this Spudder page!&body=<Check out this cool page I saw on Spudder: http://{{ request.META.HTTP_HOST }}{{ request.get_full_path }}">
                                                    <i class="fa fa-envelope-square fa-2x"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                {% endif %}
                            {% endblock %}
                        </ul>
                    </div>
                </div>
            </nav>
        {% endblock %}

        <div class="container">
            {% bootstrap_messages %}
        </div>

        {% block body %}{% endblock %}
        {% block footer %}
            <footer class="spudder-footer">
                <div class="container">
                    <div class="row hidden-sm hidden-xs main-footer">
                        <div class="col-md-2">
                            <h3>Features</h3>
                            <ul class="list-unstyled">
                                <li><a href="http://info.spudder.com/fundraising/" target="_blank">Fundraising</a></li>
                                <li><a href="http://info.spudder.com/sports-updates/" target="_blank">Sports Updates</a></li>
                                <li><a href="http://info.spudder.com/communications/" target="_blank">Safe Communications</a></li>
                                <li><a href="http://info.spudder.com/community-metrics/" target="_blank">Community Metrics</a></li>
                                <li><a href="http://info.spudder.com/parental-controls" target="_blank">Parental Controls</a></li>
                            </ul>
                        </div>
                        <div class="col-md-2">
                            <h3>About</h3>
                            <ul class="list-unstyled">
                                <li><a href="http://info.spudder.com/privacy/" target="_blank">Privacy policy</a></li>
                                <li><a href="https://docs.google.com/document/d/1z1O8dbfsKidDVfcEjZCX17v7sq07RV2Qfy5ykCrUAgE/view" target="_blank">Terms of Service</a></li>
                                <li><a href="http://spudder.zendesk.com/hc/en-us" target="_blank">Support</a></li>
                                <li><a href="http://info.spudder.com/contact" target="_blank">Contact Us</a></li>
                                <li><a href="http://info.spudder.com/meet-our-team/" target="_blank">Meet our team</a></li>
                            </ul>
                        </div>
                        <div class="col-md-2">
                            <h3>Our Platform</h3>
                            <ul class="list-unstyled">
                                <li style="margin-bottom: 10px;"><a href="/spuds"><img src="/static/img/spudderspuds/button-spuds-tiny.png" style="height:18px;"/> Spudder</a></li>
                                <li style="margin-bottom: 10px;"><a href="/cern"><img src="/static/img/spuddercern/button-cern-tiny.png" style="height:18px;"/> CERN</a></li>
                                <li style="margin-bottom: 10px;"><a href="/sponsor/splash"∂><img src="/static/img/spuddersponsors/button-sponsors-tiny.png" style="height:18px;"/> Sponsor Network</a></li>
                            </ul>
                        </div>
                        <div class="col-md-3">
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe width="560" height="315" src="//www.youtube.com/embed/liJrY694jKw" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <h3>Sports Updates Made Simple</h3>
                            <p>
                                Our patent pending system gives more than just the score, it gives amateur sports leagues a platform to connect, promote, fund and grow their local communities with about 50% the effort.
                            </p>
                        </div>
                    </div>
                    <div class="clearfix row sub-footer">
                        <ul class="list-inline pull-right">
                            <li><a href="https://www.facebook.com/spudderdotcom" target="_blank" title="Spudder on Facebook"><i class="fa fa-fw fa-facebook "></i></a></li>
                            <li><a href="https://twitter.com/spudder_com" target="_blank" title="Spudder on Twitter"><i class="fa fa-fw fa-twitter "></i></a></li>
                            <li><a href="https://www.linkedin.com/company/5012950" target="_blank" title="Spudder on LinkedIn"><i class="fa fa-fw fa-linkedin "></i></a></li>
                            <li><a href="https://plus.google.com/+Spudder/posts" target="_blank" title="Spudder on G+"><i class="fa fa-fw fa-google-plus "></i></a></li>
                            <li><a href="http://www.pinterest.com/spudderdotcom/" target="_blank" title="Spudder on Pinterest"><i class="fa fa-fw fa-pinterest "></i></a></li>
                        </ul>
                        <div class="copyright">
                            <p>
                                <span>&copy; Spudder LLC 2014 All right reserved.</span>
                            </p>
                        </div>
                        <div class="hidden-md hidden-lg text-center">
                            <ul class="list-inline">
                                <li><a href="http://info.spudder.com/privacy/" target="_blank">Privacy policy</a></li>
                                <li><a href="https://docs.google.com/document/d/1z1O8dbfsKidDVfcEjZCX17v7sq07RV2Qfy5ykCrUAgE/view" target="_blank">Terms of Service</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        {% endblock %}

        <script type="text/javascript" language="javascript">

            function fix_footer_position(){
                setTimeout(function(){
                    var $footer = $('.spudder-footer');
                    if ($(document).height() > $(window).height())
                        $footer.css({top: ''});
                    else
                        $footer.css({top: $(window).height() - $footer.outerHeight()});
                }, 500);
            }

            function balance_element_height(selector) {
                var max_height = 0;
                $(selector).each(function(i, el){
                    var $el = $(el);
                    if ($el.height() > max_height)
                        max_height = $el.height();
                });
                if (max_height == 0)
                    return;
                $(selector).each(function(i, el){
                    $(el).height(max_height);
                });
            }


            function balance_element_width(selector) {
                var max_width = 0;
                $(selector).each(function(i, el){
                    var $el = $(el);
                    if ($el.width() > max_width)
                        max_width = $el.width();
                });
                if (max_width == 0)
                    return;
                $(selector).each(function(i, el){
                    $(el).width(max_width + 10);
                });
            }


            $(document).ready(function(){

                /* GLOBAL - set the footer position */
                fix_footer_position();
                $(window).on('resize', function() { fix_footer_position(); });

                /* GLOBAL - auto hide .alert-autohide alerts after two seconds */
                $('.alert-autohide').livequery(function(){
                    var $alert = $(this);
                    var timeout = 2000;
                    if ($alert.is('.alert-error'))
                        timeout = 5000;
                    setTimeout(function(){
                        var $form = $alert.parents('form:first');
                        if ($form.length > 0)
                            $form.find('.has-success').removeClass('has-success');
                        $alert.remove();
                    }, 5000);
                });

                /* Attach to the dismissable notification */
                $('.dismiss-for-now-button').livequery(function(){
                    $(this).unbind('click').on('click', function(){
                        $(this).parents('.quote').remove();
                    });
                });
                $('.dismiss-for-good-button').livequery(function(){
                    $(this).unbind('click').on('click', function(){
                        var $container = $(this).parents('.quote');
                        $container.remove();

                        var dismissURL = '{{ info_message_url }}';
                        if (!dismissURL) {
                            dismissURL = '/cern/disable_about/';
                        }

                        $.post(dismissURL, {message_id: $container.data('id')});
                    });
                });
            });

        </script>
{#        {% if user.is_authenticated %}#}
            <script type="text/javascript" src="//assets.zendesk.com/external/zenbox/v2.6/zenbox.js"></script>
            <style type="text/css" media="screen, projection">
              @import url(//assets.zendesk.com/external/zenbox/v2.6/zenbox.css);
              #zenbox_container{
                  min-width: 100px;
                  max-width: 615px;
                  width: 75%;
              }
            #zenbox_body{
                width: 100%;
            }
            </style>
            <script type="text/javascript">
                $(document).ready(function(){
                    if (typeof(Zenbox) !== "undefined") {
                        Zenbox.init({
                            dropboxID:   "20176994",
                            url:     	"https://spudder.zendesk.com",
                            tabTooltip:  "Support",
                            tabImageURL: "https://p2.zdassets.com/external/zenbox/images/tab_support.png",
                            tabColor:	"#fb810b",
                            tabPosition: "Left",
                            hide_tab: true
                        });
                    }
                });
            </script>
{#        {% endif %}#}

        {# Social Media sharing popups #}
        <script type="text/javascript">
          var url = 'http://{{ request.META.HTTP_HOST }}{{ request.get_full_path }}';

          function sendRequest(){
              var request = gapi.client.urlshortener.url.insert({
                  'resource': {'longUrl':url}
              });
              request.execute(function(response){
                  this.url = response.id;
              });
          }

          function load() {
            gapi.client.setApiKey('AIzaSyDDSFnHOspc8Xx-RKMS6qiVASBMk-4ehRk');
            gapi.client.load('urlshortener', 'v1', sendRequest);
          }

          function newPopup(url){
              window.open(url, 'popup', 'height=500, width=500, left=100, top-10, scrollbars=yes,toolbar=no,menubar=no');
          }

          function facebookPopup(){
              newPopup('http://www.facebook.com/sharer/sharer.php?u=' + url);
          }

          function linkedinPopup(){
              newPopup('http://www.linkedin.com/shareArticle?mini=true&url=' + url);
          }

          function twitterPopup(){
              if (window.twitterPopupText){
                  console.log(window.twitterPopupText);
                  window.open('http://twitter.com/intent/tweet?text=' + encodeURI(window.twitterPopupText) + ' ' + url, 'popup', 'height=500, width=500, left=100, top-10, scrollbars=yes,toolbar=no,menubar=no');
              }
              else{
                  window.open('http://twitter.com/intent/tweet?text=Check%20out%20this%20page%20' + url, 'popup', 'height=500, width=500, left=100, top-10, scrollbars=yes,toolbar=no,menubar=no');
              }
          }

          function googlePopup(){
              newPopup('https://plus.google.com/share?url=' + url);
          }

          function pinterestPopup(paramImage){
              image = paramImage || {% if venue %} "http://{{ request.META.HTTP_HOST }}/file/serve/{{ venue.logo.id }}" {% else %} {% if school %} "http://{{ request.META.HTTP_HOST }}/file/serve/{{ school.logo.id }}" {% else %} '' {% endif %}{% endif %}
              newPopup('http://pinterest.com/pin/create/button/?url=http://{{ request.META.HTTP_HOST }}{{ request.get_full_path }}&media=' + image);
          }
        </script>
        <script src="https://apis.google.com/js/client.js?onload=load"></script>
        <script type="text/javascript" src="/static/js/libs/select2.min.js"></script>
        <!-- Start Alexa Certify Javascript -->
        <script type="text/javascript">
            _atrk_opts = { atrk_acct:"UTC1k1a0CM00oS", domain:"spudder.com",dynamic: true};
            (function() { var as = document.createElement('script'); as.type = 'text/javascript'; as.async = true; as.src = "https://d31qbv1cthcecs.cloudfront.net/atrk.js"; var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(as, s); })();
        </script>
        <noscript><img src="https://d5nxst8fruw4z.cloudfront.net/atrk.gif?account=UTC1k1a0CM00oS" style="display:none" height="1" width="1" alt="" /></noscript>
        <!-- End Alexa Certify Javascript -->
        {% if 'spud_tagging'|feature_is_enabled %}
            <script type="text/javascript">
                function format(tag){
                    return "<img src='" + $(tag.element).data('img') + "' height=25px/> " + tag.text;
                }
                $(document).ready(function(){
                    $('#spud-carousel').find('.spud-add-tags').click(function(){
                        if ($(this).hasClass('btn-sm')){
                            $(this).parents('.carousel').carousel('pause');
                            $(this).siblings('#original-spud-data').hide();
                            $(this).siblings("#add-tags-div").children("#select2").select2({
                                formatResult: format,
                                formatSelection: format,
                                formatNoMatches: "No one else to tag!",
                                escapeMarkup: function(m) { return m; }
                            });
                            $(this).removeClass('btn-sm').addClass('btn-lg').css('bottom','8px').css('top', '');
                            $(this).siblings('#add-tags-div').show();
                        }
                        else{
                            var tags = $('.select2-container:visible').siblings('select').val(),
                                icon = $(this).find('.fa'),
                                btn = $(this);
                            icon.removeClass('fa-tags').addClass('fa-spin fa-spinner');
                            var response = $.post('/fan/add_spud_comment',{
                                'spud_id': $('.select2-container:visible').siblings('select').attr('krowdioID'),
                                'tags': tags
                            });
                            response.done(function(){
                                icon.removeClass('fa-spin fa-spinner').addClass('fa-tags');
                                console.log($(this))
                                btn.parents('.carousel').carousel('cycle');
                                btn.siblings('#add-tags-div').hide();
                                btn.removeClass('btn-lg').addClass('btn-sm').css('bottom', '').css('top', '8px');
                                btn.siblings('#original-spud-data').show();
                            });
                        }
                    })
                })
            </script>
        {% endif %}

        {% block js %}
        {% endblock %}
    </body>
</html>