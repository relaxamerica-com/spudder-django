{% load bootstrap3 %}
{% load spudderaccountstags %}
{% load CERN %}

<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>{% block title %}{% endblock %}</title>
        <meta name="description" content="{% block description %}{% endblock %}">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        {% block meta %}{% endblock %}
        {% block css %}{% endblock %}
        <script src="/static/js/libs/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script type="text/javascript" language="javascript" src="/static/js/libs/jquery-1.11.0.min.js"></script>
        <script type="text/javascript" language="javascript" src="/static/js/libs/bootstrap.min.js"></script>
        <script type="text/javascript" language="javascript" src="/static/js/libs/jquery.livequery.js"></script>
    </head>
    <body class="{% block body_class %}{% endblock %}" id="{% block body_id %}{% endblock %}">
        <nav class="navbar navbar-masthead navbar-default navbar-static-top" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    {% block nav_brand %}<a href="/"><img src="/static/img/spudderspuds/logo-spuds-small.png" style="height:35px;margin-top:2px;"/> </a>{% endblock %}
                </div>
                {% block masterhead %}{% endblock %}
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        {% block nav %}{% endblock %}
                        {% block current_role_nav %}
                            {% if current_role and current_role|is_cern_student %}
                                <li class="dropdown">
                                    <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                                        CERN Menu <i class="fa fa-caret-down"></i>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a href="/cern/"><i class="fa fa-fw fa-bar-chart-o"></i> Scoreboard</a></li>
                                        <li><a href="{% my_school_link request.user %}"><i class="fa fa-fw fa-users"></i> School Page</a></li>
                                        <li><a href="/cern/venues/"><i class="fa fa-fw fa-map-marker"></i> Venues</a></li>
                                        <li><a href="/cern/social_media/"><i class="fa fa-fw fa-rss"></i> Social Media</a></li>
                                        <li><a href="/cern/content/"><i class="fa fa-fw fa-edit"></i> Content</a></li>
                                        <li><a href="/cern/design/"><i class="fa fa-fw fa-pencil"></i> Design</a></li>
                                        <li><a href="/cern/testing/"><i class="fa fa-fw fa-cogs"></i> QA Testing</a></li>
                                        <li><a href="/cern/mobile/"><i class="fa fa-fw fa-mobile-phone"></i> Mobile App</a></li>
                                        <li><a href="/accounts/logout?next=/cern/"><i class="fa fa-fw fa-power-off"></i> Logout</a></li>
                                    </ul>
                                </li>
                            {% endif %}
                            {% if current_role and current_role|is_sponsor %}
                                {% include 'spuddersponsors/parts/sponsors_menu.html' %}
                            {% endif %}
                        {% endblock %}
                        {% block user_account_nav %}
                            {% if current_role %}
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        My roles <i class="fa fa-caret-down"></i>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li style=" padding: 5px 30px; min-width: 350px;">
                                            <div class="panel panel-default">
                                                <div class="panel-body">
                                                    <div class="media">
                                                        <img class="media-object pull-left" src="{{ current_role.image }}" style="height: 40px;" />
                                                        <div class="media-body">
                                                            <p class="media-heading">{{ current_role.title|safe }}</p>
                                                            <span class="label label-success">Current role</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {% if other_roles %}
                                                <hr />
                                                <p>My {% if other_roles|length > 2 %}top{% else %}other{% endif %} role{% if other_roles|length > 1 %}s{% endif %}</p>
                                                <div style="margin-left:10px;">
                                                    {% for role in other_roles %}
                                                        {% if forloop.counter < 3 %}
                                                            <hr />
                                                            <div class="media">
                                                                <img class="media-object pull-left" src="{{ role.image }}" style="height: 40px;" />
                                                                <div class="media-body">
                                                                    <p class="media-heading"><small>{{ role.title|safe }}</small></p>
                                                                    <a href="{% link_to_change_role_and_return role %}" class="btn btn-default btn-xs" style="margin:0;">
                                                                        Activate this role
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                                <hr />
                                                {% if other_roles|length > 2 %}
                                                    <div class="btn-group">
                                                        <a class="btn btn-primary btn-sm" href="/users/roles/add">
                                                            <i class="fa fa-plus"></i> Add a new role
                                                        </a>
                                                        <a class="btn btn-default btn-sm" href="/users">
                                                            View all your roles
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <div class="btn-group">
                                                        <a class="btn btn-primary btn-sm" href="/users/roles/add">
                                                            <i class="fa fa-plus"></i> Add a new role
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% else %}
                                                <div class="btn-group">
                                                    <a class="btn btn-primary btn-sm" href="/users/roles/add">
                                                        <i class="fa fa-plus"></i> Add a new role
                                                    </a>
                                                </div>
                                            {% endif %}
                                        </li>
                                    </ul>
                                </li>
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        Share Page <i class="fa fa-caret-down"></i>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a data-original-title="Share on Facebook" data-placement="bottom" href="JavaScript:facebookPopup()">
                                                <i class="fa fa-facebook-square fa-2x"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a data-original-title="Share on Twitter" data-placement="bottom" href="javascript:twitterPopup()">
                                                <i class="fa fa-twitter-square fa-2x"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a data-original-title="Share on LinkedIn" data-placement="bottom"href="Javascript:linkedinPopup()">
                                                <i class="fa fa-linkedin-square fa-2x"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a data-original-title="Share on Google+" data-placement="bottom" href="javascript:googlePopup()">
                                                <i class="fa fa-google-plus-square fa-2x"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a data-original-title="Share via Email" data-placement="bottom" href="mailto:?subject=Check out this Spudder page!&body=Check out this cool page I saw on Spudder: http://{{ request.META.HTTP_HOST }}{{ request.get_full_path }}">
                                            <i class="fa fa-envelope-square fa-2x"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                            {% else %}
                                <li>
                                    <a href="/users/account/signin">
                                        <i class="fa fa-sign-in"></i> sign in
                                    </a>
                                </li>
                            {% endif %}
                        {% endblock %}
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container">
            {% bootstrap_messages %}
        </div>

        {% block body %}{% endblock %}
        {% block footer %}
            <footer class="spudder-footer">
                <div class="container">
                    <div class="row hidden-sm hidden-xs main-footer">
                        <div class="col-md-3">
                            <h3>Features</h3>
                            <ul class="list-unstyled">
                                <li><a href="http://info.spudder.com/fundraising/">Fundraising</a></li>
                                <li><a href="http://info.spudder.com/sports-updates/">Sports Updates</a></li>
                                <li><a href="http://info.spudder.com/communications/">Safe Communications</a></li>
                                <li><a href="http://info.spudder.com/community-metrics/">Community Metrics</a></li>
                                <li><a href="http://info.spudder.com/parental-controls">Parental Controls</a></li>
                            </ul>
                        </div>
                        <div class="col-md-3">
                            <h3>About Spudder</h3>
                            <ul class="list-unstyled">
                                <li><a href="http://spudder.zendesk.com/hc/en-us">Support</a></li>
                                <li><a href="http://info.spudder.com/contact">Contact Us</a></li>
                                <li><a href="http://info.spudder.com/meet-our-team/">Meet our team</a></li>
                                <li><a href="http://info.spudder.com/Students">College Reps</a></li>
                                <li><a href="http://info.spudder.com/partner">Partners</a></li>
                            </ul>
                        </div>
                        <div class="col-md-3">
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe width="300" height="200" src="//www.youtube.com/embed/Fde3tYVcuGc?rel=0" allowfullscreen class="embed-responsive-item"></iframe>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <h3>Sports Updates Made Simple</h3>
                            <p>
                                Our patent pending system gives more than just the score, it gives amateur sports leagues a platform to connect, promote, fund and grow their local communities with about 50% the effort.
                            </p>
                        </div>
                    </div>
                    <div class="clearfix row sub-footer">
                        <ul class="list-inline pull-right">
                            <li><a href="https://www.facebook.com/spudderdotcom" target="_blank" title="Spudder on Facebook"><i class="fa fa-fw fa-facebook "></i></a></li>
                            <li><a href="https://twitter.com/spudder_com" target="_blank" title="Spudder on Twitter"><i class="fa fa-fw fa-twitter "></i></a></li>
                            <li><a href="https://www.linkedin.com/company/5012950" target="_blank" title="Spudder on LinkedIn"><i class="fa fa-fw fa-linkedin "></i></a></li>
                            <li><a href="https://plus.google.com/+Spudder/posts" target="_blank" title="Spudder on G+"><i class="fa fa-fw fa-google-plus "></i></a></li>
                            <li><a href="http://www.pinterest.com/spudderdotcom/" target="_blank" title="Spudder on Pinterest"><i class="fa fa-fw fa-pinterest "></i></a></li>
                        </ul>
                        <div class="copyright">
                            <p>
                                <span>&copy; Spudder LLC 2013 All right reserved.</span>
                            </p>
                        </div>
                    </div>
                </div>
            </footer>
        {% endblock %}

        <script type="text/javascript" language="javascript">

            function fix_footer_position(){
                setTimeout(function(){
                    var $footer = $('.spudder-footer');
                    if ($(document).height() > $(window).height())
                        $footer.css({top: ''});
                    else
                        $footer.css({top: $(window).height() - $footer.outerHeight()});
                }, 500);
            }


            $(document).ready(function(){

                /* GLOBAL - set the footer position */
                fix_footer_position();
                $(window).on('resize', function() { fix_footer_position(); });

                /* GLOBAL - auto hide .alert-autohide alerts after two seconds */
                $('.alert-autohide').livequery(function(){
                    var $alert = $(this);
                    var timeout = 2000;
                    if ($alert.is('.alert-error'))
                        timeout = 5000;
                    setTimeout(function(){
                        var $form = $alert.parents('form:first');
                        if ($form.length > 0)
                            $form.find('.has-success').removeClass('has-success');
                        $alert.remove();
                    }, 5000);
                });

                /* Attach to the dismissable notification */
                $('.dismiss-for-now-button').livequery(function(){
                    $(this).unbind('click').on('click', function(){
                        $(this).parents('.quote').remove();
                    });
                });
                $('.dismiss-for-good-button').livequery(function(){
                    $(this).unbind('click').on('click', function(){
                        var $container = $(this).parents('.quote');
                        $container.remove();
                        $.post('/cern/disable_about/', {message_id: $container.data('id')});
                    });
                });
            });

        </script>
        {% if user.is_authenticated %}
            <script type="text/javascript" src="//assets.zendesk.com/external/zenbox/v2.6/zenbox.js"></script>
            <style type="text/css" media="screen, projection">
              @import url(//assets.zendesk.com/external/zenbox/v2.6/zenbox.css);
              #zenbox_tab {top: 80% !important;}
            </style>
            <script type="text/javascript">
                $(document).ready(function(){
                    if (typeof(Zenbox) !== "undefined") {
                        Zenbox.init({
                            dropboxID:   "20173894",
                            url:     	"https://spudder.zendesk.com",
                            tabTooltip:  "Support",
                            tabImageURL: "https://p2.zdassets.com/external/zenbox/images/tab_support.png",
                            tabColor:	"#fb810b",
                            tabPosition: "Left"
                        });
                    }
                });
            </script>
        {% endif %}

        {# Social Media sharing popups #}
        <script type="text/javascript">
          var url = 'http://{{ request.META.HTTP_HOST }}{{ request.get_full_path }}'

          function sendRequest(){
              var request = gapi.client.urlshortener.url.insert({
                  'resource': {'longUrl':url,},
              })
              request.execute(function(response){
                  this.url = response.id;
              })
          }

          function load() {
            gapi.client.setApiKey('AIzaSyDDSFnHOspc8Xx-RKMS6qiVASBMk-4ehRk');
            gapi.client.load('urlshortener', 'v1', sendRequest);
          }

          function newPopup(url){
              window.open(url, 'popup', 'height=500, width=500, left=100, top-10, scrollbars=yes,toolbar=no,menubar=no');
          }

          function facebookPopup(){
              newPopup('http://www.facebook.com/sharer/sharer.php?u=' + url);
          }

          function linkedinPopup(){
              newPopup('http://www.linkedin.com/shareArticle?mini=true&url=' + url);
          }

          function twitterPopup(){
              window.open('http://twitter.com/intent/tweet?text=Check%20out%20this%20page%20' + url, 'popup', 'height=500, width=500, left=100, top-10, scrollbars=yes,toolbar=no,menubar=no');
          }

          function googlePopup(){
              newPopup('https://plus.google.com/share?url=' + url);
          }
        </script>
        <script src="https://apis.google.com/js/client.js?onload=load"></script>
        {% block js %}
        {% endblock %}
    </body>
</html>