{% extends 'components/sharedpages/public_page_base.html' %}

{% load krowdio %}
{% load spudderspudstags %}

{% block google_analytics_additions %}
    ga('set', 'contentGroup1', 'CERN Students - Venue View');
{% endblock %}

{% block title %}{{ venue.aka_name }} ({{ venue.sport }}) | Spudder - Sports Updates Made Simple{% endblock %}

{% block page_meta %}
    {% if venue.aka_name and venue.sport %}
    <meta property="og:title" content="{{ venue.aka_name }} | Spudder - Sports Updates Made Simple">
    <meta property="og:description" content="Need directions, closest hospital information, details on seating, or playing conditions? Everything about {{ venue.aka_name }} in one place!">
    {% endif %}
    {% if venue.logo %}<meta property="og:image" content="http://{{ request.META.HTTP_HOST }}/file/serve/{{ venue.logo.id }}">
        {% else %}<meta property="og:image" content="http://{{ request.META.HTTP_HOST }}/static/img/spuddersponsors/button-sponsors-large.png">
    {% endif %}
{% endblock %}

{% block favicon %}"/media/ico/favicon.png"{% endblock %}

{% block nav_brand %}<a href="/"><img src="/static/img/spudderspuds/logo-spuds-small.png" style="height:35px;margin-top:2px;"/> </a>{% endblock %}

{% block cover_image_container_id %}{% if not venue.cover_image %}jumbo-map-container{% endif %}{% endblock %}

{% block cover_image_css_background %}{% if venue.cover_image %}/file/serve/{{ venue.cover_image.id }}{% endif %}{% endblock %}

{% block cover_image_edit_url %}/venues/edit_cover/{{ venue.id }}{% endblock %}

{% block cover_title_profile_image_url %}
    {% if sponsor and sponsor.thumbnail %}
        /file/serve/{{ sponsor.thumbnail }}
    {% else %}
        {% if venue.logo %}/file/serve/{{ venue.logo.id }}{% else %}/static/img/spuddersponsors/button-sponsors-medium.png{% endif %}
    {% endif %}
{% endblock %}

{% block cover_title_display_name %}{{ venue.aka_name }}{% endblock %}

{% block cover_title_additions %}
    <p>Sponsored By: <b>{% if sponsor %}<a href="/sponsor/{{ sponsor.id }}">@{{ sponsor.tag }}</a>{% else %}@postspud{% endif %}</b></p>
{% endblock %}

{% block cover_title_action_buttons %}
    <a href="https://www.google.com/maps/dir/Current+Location/{{ venue.latitude }},{{ venue.longitude }}" target="_blank" class="social-link"><i class="fa fa-map-marker"></i></a>
    {% if request.can_edit %}
        <button class="btn btn-primary" id="edit">
            Edit Mode
        </button>
    {% endif %}
{% endblock %}

{% block main_page %}
    <div class="edit-mode well">
        <h2>Edit basic venue details</h2>
        <form method="post" enctype="multipart/form-data" role="form">
            <div class="form-group edit-mode edit-mode-sponsor">
                <label>Upload a profile image (logo):</label>
                <input type="file" name="file" id="edit-logo" class="form-control" />
            </div>

            <div class="form-group edit-mode">
                <label>Venue @tag Name:</label>
                <div class="input-group">
                    <div class="input-group-addon">@</div>
                    <input type="text" name="name" value="{{ venue.name }}" id="venue-name-input"  class="form-control"/>
                </div>
            </div>

            <div class="form-group">
                <label>Venue Common Name:</label>
                <input type="text" name="aka_name" value="{{ venue.aka_name }}" id="venue-aka-name-input"  class="form-control"/>
            </div>

            <a class="btn btn-primary edit-mode" id="save-name"><i class="fa fa-fw fa-save"></i> Save</a>
        </form>
        <div class="alert" id="logo-name-alert" style="margin-top:10px"></div>
    </div>

    {% if request.can_edit %}
        {% with info_message_id="venues_can_edit" %}
            {% if info_message_id not in student.hidden_info_messages %}
                {% include 'spuddercern/quote_messages/quote_venue_instructions.html' %}
            {% endif %}
        {% endwith %}
    {% endif %}

    <div id="venue-property-buttons">
        <div class="btn-group hidden-sm hidden-xs btn-group-justified" style="margin: 0 auto;">
            {% include 'spuddercern/parts/venue_view_buttons_row_one.html' %}
            {% include 'spuddercern/parts/venue_view_buttons_row_two.html' %}
        </div>
        <div class="btn-group hidden-md hidden-lg btn-group-justified" style="margin: 0 auto 10px;">
            {% include 'spuddercern/parts/venue_view_buttons_row_one.html' %}
        </div>
        <div class="btn-group hidden-md hidden-lg btn-group-justified" style="margin: 0 auto;">
            {% include 'spuddercern/parts/venue_view_buttons_row_two.html' %}
        </div>
    </div>

    <div class="content-navigation edit-mode" style="margin: 10px 0;">
        <button class="btn btn-primary pull-left" style="display:none" id="previous">Previous</button>
        <button class="btn btn-primary pull-right" id="next">Next</button>
    </div>

    <div style="min-height: 362px; margin: 0 auto; width: 100%; vertical-align: middle; text-align: center; padding:15px;">
        <div class="row-fluid" style="height:100%;">
            <div class="col-md-12 contents" style="height:100%;">
                <div class="alert"></div>
                <div class="content active" id="spuds">
                    {% include 'components/spuds/spud_carousel.html' with spuds=venue_spuds title='<abbr title="Sports Updates">SPUDS</abbr> from this venue' %}
                </div>
                <div class="content" id="map">
                    {% if request.can_edit and not venue.location_has_been_changed %}
                        <div class="edit-mode">
                            <a class="btn btn-primary" id="edit-venue-location-button">Edit Venue Location</a>
                        </div>
                        <div id="edit-venue-location" style="display:none">
                            <p>To edit the venue location, drag the map until it is centered on the venue, and then click:</p>
                            <p><a class="btn btn-primary" id="place-map-marker">Place Map Marker</a></p>
                        </div>
                        <div class="alert" style="display:none" id="location-alert"></div>
                    {% endif %}
                    <div id="map-canvas" class="view-venue-map">

                    </div>

                    <div class="buttons" id="flagcontent" style="float:right;">
                        <i class="fa fa-flag" title="FlagContent" style="width: 80%; font-size: 10pt; height: 13px;line-height: 13px;">
                            FLAG THIS
                        </i>
                    </div>

                </div>
                <div id="parking-details" class="content">
                    <div class="row-fluid edit-mode">
                        <form method="post" enctype="multipart/form-data" role="form">
                            <div class="col-md-6">
                                <p>
                                    Select up to 5 pictures of parking and upload them
                                </p>
                                <input type="file" name="file" multiple="multiple" />
                            </div>
                            <div class="col-md-6">
                                <textarea placeholder="Enter parking details" name="details" id="parking-details-input">{{ venue.parking_details }}</textarea>
                            </div>
                            <div class="col-md-6">
                                <a id="upload-parking" class="btn btn-primary pull-left">Upload</a>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="row-fluid" style="height: 70%; width: 70%; margin: 0 auto;">
                        <div class="carousel slide {% if not venue.parking_pics %}hidden{% endif %}" id="parking-carousel" style="max-width: 95%; margin: 0 auto;">
                            <div class="carousel-inner">
                                {% for pic in venue.parking_pics %}
                                <div class="{% if forloop.counter == 1 %}active{% endif %} item">
                                    <img src="{{ pic }}" />
                                </div>
                                {% endfor %}
                            </div>
                            <a href="#parking-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
                            <a href="#parking-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

                            <div class="btn btn-danger remove-pic edit-mode" id="parking_pics">Remove</div>
                            <div class="pin-pic view-mode" id="parking_pics_pin"><a href="#"><i class="fa fa-pinterest fa-2x"></i></a></div>
                        </div>
                        <div class="col-md-12 view-mode" style="width: 95%; margin: 0 auto; float: none;">
                            <p class="text-center">Parking Details</p>
                            <div class="well" id="parking-details-well">
                                {{ venue.parking_details }}
                            </div>
                        </div>
                    </div>
                </div>
                <div id="up-to-5-pics" class="content">
                    <div class="row-fluid edit-mode margin-bottom20">
                        <form method="post" enctype="multipart/form-data" role="form">
                            <div class="col-md-6 col-md-offset-3">
                                <p>
                                    Select up to 5 pictures to upload
                                </p>
                                <input type="file" name="file" multiple="multiple" />"
                            </div>
                            <div class="col-md-6 col-md-offset-3">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <a id="upload-up-to-5-pics" class="btn btn-primary pull-left">Upload</a>
                            </div>
                        </form>
                    </div>
                    <div class="row-fluid">
                        <div class="{% if not venue.venue_pics %}hidden{% endif %} carousel slide" id="venue-pics-carousel">
                            <div class="carousel-inner">
                                {% for pic in venue.venue_pics %}
                                <div class="{% if forloop.counter == 1 %}active{% endif %} item">
                                    <img src="{{ pic }}" />
                                </div>
                                {% endfor %}
                            </div>
                            <a href="#venue-pics-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
                            <a href="#venue-pics-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

                            <div class="btn btn-danger remove-pic edit-mode" id="venue_pics">Remove</div>
                            <div class="pin-pic view-mode" id="venue_pics_pin"><a href="#"><i class="fa fa-pinterest fa-2x"></i></a></div>
                        </div>
                    </div>
                </div>
                <div id="video" class="content">
                    <div class="row-fluid edit-mode">
                        <p>
                            Paste Youtube embed code here
                        </p>
                        <form method="post" class="form-horizontal" role="form">
                            <textarea name="video" placeholder="Youtube video's embed code">{{ venue.video }}</textarea>
                            <div>
                                <a id="save-video" class="btn btn-primary">Save</a>
                            </div>
                        </form>
                    </div>
                    <div class="row-fluid view-mode" id="venue-video" style="height:100%;">
                        <div class="embed-responsive embed-responsive-16by9">
                            {{ venue.video|safe|default:'<iframe width="100%" height="100%" src="//www.youtube.com/embed/Fde3tYVcuGc?rel=0" frameborder="0" allowfullscreen></iframe>' }}
                        </div>
                    </div>
                </div>
                <div id="playing-surface" class="content">
                    <div class="row-fluid edit-mode">
                        <form method="post" enctype="multipart/form-data" role="form">
                            <div class="col-md-6">
                                <p>
                                    Select up to 5 pictures of playing surface and upload them
                                </p>
                                <input type="file" name="file" multiple="multiple" />
                            </div>
                            <div class="col-md-6">
                                <textarea placeholder="Enter playing surface details" name="details" id="playing-surface-details">{{ venue.playing_surface_details }}</textarea>
                            </div>
                            <div class="col-md-6 col-md-offset-3">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <a id="upload-playing-surface" class="btn btn-primary pull-left">Upload</a>
                            </div>
                        </form>
                    </div>
                    <div class="row-fluid" style="height: 70%; width: 70%; margin: 0 auto;">
                        <div class="carousel slide {% if not venue.playing_surface_pics %}hidden{% endif %}" id="playing-surface-carousel" style="max-width: 95%; margin: 0 auto;">
                            <div class="carousel-inner">
                                {% for pic in venue.playing_surface_pics %}
                                <div class="{% if forloop.counter == 1 %}active{% endif %} item">
                                    <img src="{{ pic }}" />
                                </div>
                                {% endfor %}
                            </div>
                            <a href="#playing-surface-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
                            <a href="#playing-surface-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

                            <div class="btn btn-danger remove-pic edit-mode" id="playing_surface_pics">Remove</div>
                            <div class="pin-pic view-mode" id="venue_pics_pin"><a href="#"><i class="fa fa-pinterest fa-2x"></i></a></div>
                        </div>
                        <div class="col-md-12 view-mode" style="width: 95%; margin: 0 auto; float: none;">
                            <p class="text-center">Playing Surface Details</p>
                            <div class="well" id="playing_surface_details_well">
                                {{ venue.playing_surface_details }}
                            </div>
                        </div>
                    </div>

                </div>
                <div id="flag-content" class="content">
                    <div class="row-fluid">
                        <form role="form" class="form-horizontal">
                            <div class="form-group hidden-xs hidden-sm hidden-md hidden-lg">
                                <input type="text" name="email" value="" id="email-field" />
                                {# Note that this is only here to fool bots, a bot will fill this in and then we will know that its a bot and can filter it out #}
                            </div>
                            <div class="form-group">
                                <label class="col-md-4 col-md-offset-2">Send message to Groundskeeper</label>
                                <textarea class="col-md-4" placeholder="Message content" name=message id="message-field"></textarea>
                            </div>
                            <a class="btn btn-primary" id="send-message">Contact Groundskeeper</a>
                        </form>
                    </div>
                </div>
                <div id="restroom-details" class="content">
                    <div class="row-fluid edit-mode">
                        <form method="post" class="form-horizontal" enctype="multipart/form-data" role="form">
                            <div class="col-md-6">
                                <p>
                                    Select up to 5 pictures of restroom and upload them
                                </p>
                                <input type="file" name="file" multiple="multiple" />
                            </div>
                            <div class="col-md-6">
                                <p>
                                    Restroom Details
                                </p>
                                <textarea placeholder="Enter restroom details" name="details">{{ venue.restroom_details }}</textarea>
                            </div>
                            <div class="col-md-6">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <a id="save-restroom-details" class="btn btn-primary pull-left">Upload</a>
                            </div>
                        </form>
                    </div>
                    <div class="row-fluid">
                        <div class="carousel slide {% if not venue.restroom_pics %}hidden{% endif %}" id="restroom-carousel">
                            <div class="carousel-inner">
                                {% for pic in venue.restroom_pics %}
                                <div class="{% if forloop.counter == 1 %}active{% endif %} item">
                                    <img src="{{ pic }}" />
                                </div>
                                {% endfor %}
                            </div>
                            <a href="#restroom-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
                            <a href="#restroom-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

                            <div class="btn btn-danger remove-pic edit-mode" id="restroom_pics">Remove</div>
                            <div class="pin-pic view-mode" id="venue_pics_pin"><a href="#"><i class="fa fa-pinterest fa-2x"></i></a></div>
                        </div>
                        <div class="col-md-6 nomargin view-mode" id="venue-restroom-details" style="width: 100%;">
                            <p class="view-mode">
                                Restroom Details
                            </p>
                            <div class="well">
                                {{ venue.restroom_details }}
                            </div>
                        </div>
                    </div>
                </div>
                <div id="concession-details" class="content">
                    <div class="row-fluid edit-mode">
                        <form method="post" enctype="multipart/form-data" role="form">
                            <div class="form-group col-md-6">
                                <p>
                                    Select up to 5 pictures of concessions and upload them
                                </p>
                                <input type="file" name="file" multiple="multiple" />
                            </div>
                            <div class="form-group">
                                <textarea class="col-md-6" placeholder="Enter concessions details" name="details" id="concession-details-input">{{ venue.concession_details }}</textarea>
                            </div>
                            <div class="col-md-6 col-md-offset-3">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <a id="upload-concession" class="btn btn-primary text-center">Upload</a>
                            </div>
                        </form>
                    </div>
                    <div class="row-fluid" style="height: 70%; width: 70%; margin: 0 auto;">
                        <div class="carousel slide {% if not venue.concession_pics %}hidden{% endif %}" id="concession-carousel" style="max-width: 95%; margin: 0 auto;">
                            <div class="carousel-inner">
                                {% for pic in venue.concession_pics %}
                                <div class="{% if forloop.counter == 1 %}active{% endif %} item">
                                    <img src="{{ pic }}" />
                                </div>
                                {% endfor %}
                            </div>
                            <a href="#concession-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
                            <a href="#concession-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

                            <div class="btn btn-danger remove-pic edit-mode" id="concession_pics">Remove</div>
                            <div class="pin-pic view-mode" id="concession_pics_pin"><a href="#"><i class="fa fa-pinterest fa-2x"></i></a></div>
                        </div>
                        <div class="col-md-12 view-mode" style="width: 95%; margin: 0 auto; float: none;">
                            <p class="text-center">Concessions Details</p>
                            <div class="well" id="concession-details-well">
                                {{ venue.concession_details }}
                            </div>
                        </div>
                    </div>
                </div>
                <div id="admission-details" class="content">
                    <div class="row-fluid edit-mode">
                        <form method="post" enctype="multipart/form-data" role="form">
                            <div class="col-md-6">
                                <p>
                                    Select up to 5 pictures of admissions &amp; seating and upload them
                                </p>
                                <input type="file" name="file" multiple="multiple" />
                            </div>
                            <div class="col-md-6">
                                <textarea placeholder="Enter admissions and seating details" name="details" id="admission-details-input">{{ venue.admission_details }}</textarea>
                            </div>
                            <div class="col-md-6 col-md-offset-3">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <a id="upload-admission" class="btn btn-primary pull-left">Upload</a>
                            </div>
                        </form>
                    </div>
                    <div class="row-fluid" style="height: 70%; width: 70%; margin: 0 auto;">
                        <div class="carousel slide {% if not venue.admission_pics %}hidden{% endif %}" id="admission-carousel" style="max-width: 95%; margin: 0 auto;">
                            <div class="carousel-inner">
                                {% for pic in venue.admission_pics %}
                                <div class="{% if forloop.counter == 1 %}active{% endif %} item">
                                    <img src="{{ pic }}" />
                                </div>
                                {% endfor %}
                            </div>
                            <a href="#admission-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
                            <a href="#admission-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

                            <div class="btn btn-danger remove-pic edit-mode" id="admission_pics">Remove</div>
                            <div class="pin-pic view-mode" id="parking_pics_pin"><a href="#"><i class="fa fa-pinterest fa-2x"></i></a></div>
                        </div>
                        <div class="col-md-12 view-mode" style="width: 95%; margin: 0 auto; float: none;">
                            <p class="text-center">Admissions &amp; Seating Details</p>
                            <div class="well" id="admission-details-well">
                                {{ venue.admission_details }}
                            </div>
                        </div>
                    </div>
                </div>
                <div id="medical-details" class="content">
                    <div class="row-fluid edit-mode">
                        <form method="post" class="form-horizontal" role="form">
                            <p>
                                Address of nearby facility
                            </p>
                            <div class="form-group">
                                <label class="col-md-4 col-md-offset-2">Nearest Hospitals</label>
                                <select class="col-md-4" name="hospital">
                                    <option>---</option>
                                </select> <img id="loading-nearest" class="hidden" src="/media/img/ajax-loader.gif" />
                            </div>
                            <div class="form-group">
                                <label class="col-md-4 col-md-offset-2">Address</label>
                                <input class="col-md-4" type="text" placeholder="address" name="address" value="{{ medical_address.address }}"/>
                            </div>
                            <div class="form-group">
                                <label class="col-md-4 col-md-offset-2">City</label>
                                <input class="col-md-4" type="text" placeholder="city" name="city" value="{{ medical_address.city }}" />
                            </div>
                            <div class="form-group">
                                <label class="col-md-4 col-md-offset-2">State</label>
                                {% include 'old/commons/select_state.html' %}
                            </div>
                            <div class="form-group">
                                <label class="col-md-4 col-md-offset-2">Zip</label>
                                <input class="col-md-4" type="text" placeholder="zip" name="zip" value="{{ medical_address.zip }}" />
                            </div>
                            <p>
                                <a id="save-medical-details" class="btn btn-primary">Save</a>
                            </p>
                        </form>
                    </div>
                    <div class="row-fluid view-mode">
                        <div class="col-md-6" style="width:100%;">
                            <p>
                                Nearby Medical Facility:
                            </p>
                            <div class="well" style="width:100%;">
                                <a href="http://maps.google.com/?q={{ venue.medical_address }}" target="_blank" id="venue-medical-address">
                                    {{ venue.medical_address }}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="handicap-details" class="content">
                    <div class="row-fluid edit-mode">
                        <form method="post" enctype="multipart/form-data" role="form">
                            <div class="col-md-6">
                                <p>
                                    Select up to 5 pictures of handicapped accessibility features and upload them
                                </p>
                                <input type="file" name="file" multiple="multiple" />
                            </div>
                            <div class="col-md-6">
                                <textarea placeholder="Enter handicapped accessibility details" name="details" id="handicap-details-input">{{ venue.handicap_details }}</textarea>
                            </div>
                            <div class="col-md-6 col-md-offset-3">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <a id="upload-handicap" class="btn btn-primary pull-left">Upload</a>
                            </div>
                        </form>
                    </div>
                    <div class="row-fluid" style="height: 70%; width: 70%; margin: 0 auto;">
                        <div class="carousel slide {% if not venue.handicap_pics %}hidden{% endif %}" id="handicap-carousel" style="max-width: 95%; margin: 0 auto;">
                            <div class="carousel-inner">
                                {% for pic in venue.handicap_pics %}
                                <div class="{% if forloop.counter == 1 %}active{% endif %} item">
                                    <img src="{{ pic }}" />
                                </div>
                                {% endfor %}
                            </div>
                            <a href="#handicap-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
                            <a href="#handicap-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

                            <div class="btn btn-danger remove-pic edit-mode" id="handicap_pics">Remove</div>
                            <div class="pin-pic view-mode" id="parking_pics_pin"><a href="#"><i class="fa fa-pinterest fa-2x"></i></a></div>
                        </div>
                        <div class="col-md-12 view-mode" style="width: 95%; margin: 0 auto; float: none;">
                            <p class="text-center">Handicapped Accesibility Details</p>
                            <div class="well" id="handicap-details-well">
                                {{ venue.handicap_details }}
                            </div>
                        </div>
                    </div>
                </div>
                <div id="teams" class="content">
                    <div class="page-header">
                        <h2><i class="fa fa-group"></i> Teams associated with this venue</h2>
                    </div>
                    {% if not teams %}
                        {% include 'spuddercern/quote_messages/quote_no_teams_associated_with_venue.html' %}
                    {% else %}
                        <table class="table table-striped" style="margin-top: 20px;">
                            {% for team in teams %}
                                <tr>
                                    <td style="width:40px;vertical-align: middle;">
                                        <a href="/team/{{ team.id }}" style="text-decoration: none;">
                                            <img src="{% if team.logo %}/file/serve/{{ team.image.id }}{% else %}/static/img/spudderspuds/button-teams-medium.png{% endif %}" height="30px;"/>
                                        </a>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <a href="/team/{{ team.id }}" style="text-decoration: none;">
                                            {{ team }}
                                        </a>
                                    </td>
                                    <td style="vertical-align: middle;" class="hidden-xs">
                                        @{{ team.at_name }}
                                    </td>
                                    {% if request.can_edit %}
                                        <td style="width:100px; vertical-align: middle;">
                                            <a class="btn btn-danger btn-sm" href="javascript:removeAssociation('{{ team.id }}', '{{ team.name }}');">
                                                Remove association
                                            </a>
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </table>
                    {% endif %}
                </div>
            </div>
        </div>

        <hr />
    </div>
{% endblock %}

{% block sidebar %}
    {% if request.current_role.entity == venue.student %}
        {% if not venue.renter %}
            {% include 'spuddercern/quote_messages/quote_venue_sponsors_coming_soon_can_edit.html' %}
        {% else %}
            {% include 'spuddercern/quote_messages/quote_venue_rented_for_student.html' %}
        {% endif %}
        <hr>
    {% else %}
        {% if not sponsor_info %}
            {% if venue.renter %}
                {% include 'spuddercern/quote_messages/quote_venue_reserved.html' %}
            {% else %}
                {% include 'spuddercern/quote_messages/quote_venue_sponsors_coming_soon.html' %}
            {% endif %}
            <hr>
        {% endif %}
    {% endif %}

    {% if sponsor %}
        <div id="venue-sponsor-container">
            {% if sponsor.thumbnail %}
                <img id="sponsor-logo" src="/file/serve/{{ sponsor.thumbnail }}" onclick="window.open('/sponsor/{{ sponsor.id }}', '_blank')"/>
            {% endif %}

            <h3>
                Support Venue's Sponsor
            </h3>

            {% social_media_list sponsor %}

            <ul class="sponsor-details">
                {% if sponsor.speciality %}
                    <li>
                        <label>Speciality: </label> {{ sponsor.speciality }}
                    </li>
                {% endif %}

                {% if sponsor.location %}
                    <li>
                        <label>Location: </label> <a href="http://maps.google.com/?q={{ sponsor.location }}" target="_blank" id="sponsor-location">{{ sponsor.location }}</a>
                    </li>
                {% endif %}

                {% if sponsor.phone %}
                    <li>
                        <label>Phone: </label> {{ sponsor.phone }}
                    </li>
                {% endif %}

                {% if sponsor.email %}
                    <li>
                        <label>E-mail: </label> <a href="mailto:{{ sponsor.email }}">{{ sponsor.email }}</a>
                    </li>
                {% endif %}

                {% if sponsor.website %}
                    <li>
                        <label>Website: </label> <a href="{{ sponsor.website }}">{{ sponsor.website }}</a>
                    </li>
                {% endif %}

                {% if sponsor.video %}
                    <li>
                        <label>Video: </label> <a href="{{ sponsor.video }}">Sponsor video</a>
                    </li>
                {% endif %}

                {% if sponsor.fax %}
                    <li>
                        <label>Fax: </label> {{ sponsor.fax }}
                    </li>
                {% endif %}
            </ul>
        </div>
    {% endif %}
{% endblock %}


{% block js %}
{{ block.super }}
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=geometry"></script>
<script type="text/javascript" src="/static/js/libs/google.map.js"></script>
<script type="text/javascript" src="/static/js/libs/jquery.serialize.file.js"></script>
<script type="text/javascript">
    window.venueName = "{{ venue.aka_name }}";
	window.currentVenueLongitude = parseFloat("{{ venue.longitude }}");
	window.currentVenueId = "{{ venue.id }}";
	window.currentVenueLatitude = parseFloat("{{ venue.latitude }}");
	window.preloadedOrange = $('<img src="/media/img/ajax-loader-orange.gif" />');
	window.preloadedBlack = $('<img src="/media/img/ajax-loader-black.gif" />');
	window.currentSelectedSport = '{{ venue.sport }}';
    window.twitterPopupText = "Checkout all the action happening near you at {{ venue.aka_name }}!";
    window.marker = null;

{#    {% if venue.cover_image %}if($('.jumbotron').height() > $('.jumbotron-img').height()) $('.jumbotron').css('height', $('.jumbotron-img').height() + "px");{% endif %}#}

    $('.content').hide();
    $('.active').show();

	$(document).ready(function() {
        $('.progress').hide();

        $('#mailto').attr('href',
                          'mailto:?subject={{ venue.aka_name }} on Spudder' +
                          '&body=Need directions, closest hospital information, details on seating, or playing conditions? Everything about {{ venue.aka_name }} in one place! ' + url);

        $('#venue-property-buttons a').click(function(){
            if (window.isEditMode){
                $('#previous').show();
                $('#next').show();
            }
        });

        $('a[opentab="#spuds"]').click(function(){
            $('#previous').hide();
        });

        $('a[opentab="#handicap-details"]').click(function(){
            $('#next').hide();
        });

        $('a[opentab="#flag-content"]').click(function(){
            $('#previous').hide();
            $('#next').hide();
        });

        // Init the Jumbo Map
        if ($('#jumbo-map-container').is(':visible')) {
            initWithCoords(parseFloat("{{ venue.latitude }}"), parseFloat("{{ venue.longitude }}"))
        }


        $('.alert').each(function(i, alert) {
           var $alert = $(alert);
           if ($alert.html() == "")
               $alert.hide();
        });

		var hospitalSelect = $('[name="hospital"]'),
			hospitals = {};

		$('select[name="state"]').val('{{medical_address.state}}');

		$('.carousel').carousel({
			interval : false
		});

		var buttons = $('#venue-property-buttons'),
			icons = buttons.find('.btn');

		function show(element) {
			$('.contents > .active').removeClass('active');
			$(element).addClass('active');
			$(element).show();
		}

		function hide(elements) {
			$.each(elements, function() {
				$(this).css({
					'display' : 'none'
				});
			});
		}



        initialize(
            false,
            $('.contents .alert'),
            function(venue) {
                return venue.sport == window.currentSelectedSport && venue.id != parseInt(window.currentVenueId, 10);
            },
            function() {
            //$('#save-location').removeClass('hidden');
            }
        );

		icons.click(function() {
			if(!$(this).hasClass('active')) {
				var currentTab = $(this).attr('openTab');

				$('.alert').not('.alert-info').hide();

				buttons.find('.active').removeClass('active');

				hide($('.contents > div.content'));

				$(this).addClass('active');

				show(currentTab);
			}

			if ($(this).find('i').hasClass('fa-map-marker')) {

				if (!$(this).hasClass('initialized')) {
					initialize(false, $('.contents .alert'), function(venue) {
                        return venue.sport == window.currentSelectedSport
							&& venue.id != parseInt(window.currentVenueId, 10);
					}, function() {
						//$('#save-location').removeClass('hidden');
					});
				}
			} else if ($(this).find('i').hasClass('fa-h-square')) {
				setNearestHospitals(hospitalSelect);
			} else if ($(this).find('i').hasClass('fa-camera')) {
				setRemoveButtonPosition('venue-pics-carousel');
				setPinButtonPosition('venue-pics-carousel');
			} else if ($(this).find('i').hasClass('fa-eye')) {
				setRemoveButtonPosition('playing-surface-carousel');
				setPinButtonPosition('playing-surface-carousel');
			} else if ($(this).find('i').hasClass('fa-male')) {
				setRemoveButtonPosition('restroom-carousel');
				setPinButtonPosition('restroom-carousel');
			}

		});

		$('#upload-parking').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
                alert = $('.contents').find('.alert');

			if (filesList.length > 5 || (parseInt('{{ venue.parking_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than are allowed.', 'warning', true);
				return;
			}

			var progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
                var details = $('#parking-details-input');
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_parking_details/{{ venue.id }}', {
							'parking_pics' : parsed['uploaded_files'],
							'parking_details' : details.val()
						});

						response.done(function(data) {
                            if (filesList.length > 0){
                                showAlert(alert, "Parking details have been saved (" + filesList.length + " new images uploaded).", 'success', true);
                            }
                            else showAlert(alert, "Parking details have been saved.", 'success', true);
							$('.remove').click();
							populateCarousel(parsed, $('#parking-carousel'));
							$('#parking-details-well').html(details.val());
							$('.fa-ticket').addClass('ready');

							progressBar.hide();
							progressBar.children().css('width', '0%');
						});
					}
				});
			});
		});

		function setRemoveButtonPosition(carousel_ID) {
			var active = $('#' + carousel_ID + ' .item.active img');
			$('#' + carousel_ID + ' .remove-pic').css('right', 10 + parseInt(active.css('marginRight'), 10) + 'px');
		}

		$('.remove-pic').click(function() {
			var carousel = $(this).parent(),
				listType = $(this).attr('id'),
				active = carousel.find('.active'),
				fileURL = active.find('img').attr('src');

			$(this).hide();

			var response = $.post('/venues/remove_pic/{{ venue.id }}', {
				'list_type' : listType,
				'file_url' : fileURL
			});

			carousel.carousel('next');
			active.remove();
			if (carousel.find('.item').length == 0) {
				carousel.hide();
			}
			$(this).show();
			showAlert($('.contents .alert'), 'Image has been removed', 'success', true);
		});

		function setPinButtonPosition(carousel_ID) {
			var carousel = $('#' + carousel_ID);
			$('#' + carousel_ID + ' .pin-pic').css('right', 10 + parseInt(carousel.css('marginRight'), 10) + 'px').css('bottom', 10 + parseInt(carousel.css('marginBottom'), 10) + 'px');
		}

		$('.pin-pic').click(function() {
			var carousel = $(this).parent(),
				active = carousel.find('.active'),
				fileURL = active.find('img').attr('src');

			pinterestPopup('http://{{ request.META.HTTP_HOST }}' + fileURL)
		});

		function showProgress(progressBar) {
			var xhr = new window.XMLHttpRequest();
         	progressBar.show();

     		xhr.upload.addEventListener('progress', function(evt){
     			 var percentComplete = evt.loaded / evt.total;

                 percentComplete = parseInt(percentComplete * 100);

                 progressBar.children().css('width', percentComplete + '%');
     		});

     		return xhr;
		}

		$('#upload-up-to-5-pics').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
				alert = $('.contents').find('.alert');

			if (filesList.length > 5 || (parseInt('{{ venue.venue_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than are allowed.', 'warning', true);
				return;
			}

			var progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_venue_pics/{{ venue.id }}', {
							'venue_pics' : parsed['uploaded_files']
						});

						response.done(function(data) {
                            showAlert(alert, 'You have successfully uploaded ' + filesList.length + ' images.', 'success', true);
							$('.remove').click();

							var carousel = $('#up-to-5-pics .carousel');

							populateCarousel(parsed, carousel);
							progressBar.hide();
							progressBar.children().css('width', '1%');
							$('.fa-camera').addClass('ready');

						});
					}
				});
			});
		});

		function populateCarousel(parsed, carousel) {
			$.each(parsed['uploaded_files'], function() {
				var item = $('<div class="item"></div>'),
					img = $('<img />');

				img.attr('src', this);
				if(carousel.find('.item').length == 0) {
					item.addClass('active');
				}

				item.append(img);
				carousel.find('.carousel-inner').append(item);
			});

			carousel.removeClass('hidden');
			carousel.show();
			carousel.carousel().removeData();
			carousel.carousel({ interval: false });
		}

		$('#save-name').click(function() {
			var form = $('#edit-logo').parents('form'),
				files = $(form).serializeFiles(),
				name = $('#venue-name-input').val(),
				akaName = $('#venue-aka-name-input').val(),
                alert = $('#logo-name-alert'),
                icon = $('#save-name .fa-save');

            if (name.match(/[a-z\d]*/) == name){
                icon.removeClass('fa-save').addClass('fa-spin fa-spinner');

                $.get('/upload/get_upload_url', function (data) {
                    $.ajax({
                        url: data,
                        data: files,
                        cache: false,
                        contentType: false,
                        processData: false,
                        type: 'POST',
                        success: function (data) {
                            var parsed = JSON.parse(data);

                            var response = $.post('/venues/save_logo_and_name/{{ venue.id }}', {
                                'logo': parsed['uploaded_files'],
                                'name': name,
                                'aka_name': akaName,
                            });

                            response.done(function (data) {
                                icon.removeClass('fa-spin fa-spinner').addClass('fa-save');
                                showAlert(alert, "Venue name and logo have been saved.", 'success', true);

                                $('#venue-name').html(akaName);
                                if (parsed['uploaded_files'].length > 0) {
                                    $('#venue-logo').attr('src', parsed['uploaded_files'][0]);
                                }

                            });
                        }
                    });
                });
            } else{
                showAlert(alert, 'The @tag name contains invalid characters. Only lowercase letters and numbers are allowed.', 'danger', true);
            }
		});

		$('#upload-playing-surface').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
                alert = $('.contents').find('.alert');

			if (filesList.length > 5 || (parseInt('{{ venue.playing_surface_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than are allowed.', 'warning', true);
				return;
			}

			var progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
                var details = $('#playing-surface-details');
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_playing_surface_pics/{{ venue.id }}', {
							'playing_surface_pics' : parsed['uploaded_files'],
							'playing_surface_details' : details.val()
						});

						response.done(function(data) {
                            if (filesList.length > 0){
                                showAlert(alert, "Playing surface details have been saved (" + filesList.length + " new images uploaded).", 'success', true);
                            }
                            else showAlert(alert, "Playing surface details have been saved.", 'success', true);
							$('.remove').click();
							populateCarousel(parsed, $('#playing-surface-carousel'));
							$('#playing-surface-details-well').html(details.val());
							$('.fa-ticket').addClass('ready');

							progressBar.hide();
							progressBar.children().css('width', '0%');
						});
					}
				});
			});
		});


		$('#save-video').click(function() {
			var textarea = $('#video form textarea');

			var response = $.post('/venues/save_video/{{ venue.id }}', {
				'video' : textarea.val()
			});

			response.done(function() {
                showAlert(alert, "Video embed code has been saved.", 'success', true);
                $('.remove').click();
				$('#venue-video').html(textarea.val());
				$('.fa.fa-youtube-play').addClass('ready');
			});
		});

		$('#save-restroom-details').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
                alert = $('.contents').find('.alert');

			if (filesList.length > 5 || (parseInt('{{ venue.restroom_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than are allowed.', 'warning', true);
				return;
			}

			var details = $('[name="details"]'),
				progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					xhr: function() {
                 		return showProgress(progressBar);
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_restroom_details/{{ venue.id }}', {
							'restroom_pics' : parsed['uploaded_files'],
							'restroom_details' : details.val()
						});

						response.done(function(data) {
                            if (filesList.length > 0){
                                showAlert(alert, "Restroom details have been saved (" + filesList.length + " new images uploaded).", 'success', true);
                            }
                            else showAlert(alert, "Restroom details have been saved.", 'success', true);
							$('.remove').click();
							$('#venue-restroom-details').html(details.val());
							$('.fa-male').addClass('ready');
							populateCarousel(parsed, $('#playing-surface-carousel'));
							progressBar.hide();
							progressBar.children().css('width', '0%');
						});
					}
				});
			});
		});

		$('#upload-concession').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
                alert = $('.contents').find('.alert');

			if (filesList.length > 5 || (parseInt('{{ venue.concession_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than are allowed.', 'warning', true);
				return;
			}

			var progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
                var details = $('#concession-details-input');
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_concession_details/{{ venue.id }}', {
							'concession_pics' : parsed['uploaded_files'],
							'concession_details' : details.val()
						});

						response.done(function(data) {
                            if (filesList.length > 0){
                                showAlert(alert, "Concession details have been saved (" + filesList.length + " new images uploaded).", 'success', true);
                            }
                            else showAlert(alert, "Concession details have been saved.", 'success', true);
							$('.remove').click();
							populateCarousel(parsed, $('#concession-carousel'));
							$('#concession-details-well').html(details.val());
							$('.fa-ticket').addClass('ready');

							progressBar.hide();
							progressBar.children().css('width', '0%');
						});
					}
				});
			});
		});

		$('#upload-admission').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
                alert = $('.contents').find('.alert');

			if (filesList.length > 5 || (parseInt('{{ venue.admission_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than are allowed.', 'warning', true);
				return;
			}

			var progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
                var details = $('#admission-details-input');
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_admission_details/{{ venue.id }}', {
							'admission_pics' : parsed['uploaded_files'],
							'admission_details' : details.val()
						});

						response.done(function(data) {
                            if (filesList.length > 0){
                                showAlert(alert, "Admission & Seating details have been saved (" + filesList.length + " new images uploaded).", 'success', true);
                            }
                            else showAlert(alert, "Admission & Seating details have been saved.", 'success', true);
							$('.remove').click();
							populateCarousel(parsed, $('#admission-carousel'));
							$('#admission-details-well').html(details.val());
							$('.fa-ticket').addClass('ready');

							progressBar.hide();
							progressBar.children().css('width', '0%');
						});
					}
				});
			});
		});

		$('#save-medical-details').click(function() {
			var address = $('#medical-details form input[name="address"]'),
				city = $('#medical-details form input[name="city"]'),
				state = $('#medical-details form select[name="state"]'),
				zip = $('#medical-details form input[name="zip"]'),
                alert = $('.contents').find('.alert');

			var medicalAddress = address.val() + ', ' + city.val() + ', ' + state.val() + ', ' + zip.val();

			var response = $.post('/venues/save_medical_details/{{ venue.id }}', {
				'medical_address' : medicalAddress,
			});

			response.done(function() {
                showAlert(alert, "Medical address has been saved.", 'success', true);
				$('#venue-medical-address').html(medicalAddress);
				$('.fa-h-square').addClass('ready');
				$('#venue-medical-address').attr('href', 'http://maps.google.com/?q=' + medicalAddress);
			});
		});

		$('#upload-handicap').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
                alert = $('.contents').find('.alert');

			if (filesList.length > 5 || (parseInt('{{ venue.handicap_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than are allowed.', 'warning', true);
				return;
			}

			var progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
                var details = $('#handicap-details-input');
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_handicap_details/{{ venue.id }}', {
							'handicap_pics' : parsed['uploaded_files'],
							'handicap_details' : details.val()
						});

						response.done(function(data) {
                            if (filesList.length > 0){
                                showAlert(alert, "Handicapped accessibility details have been saved (" + filesList.length + " new images uploaded).", 'success', true);
                            }
                            else showAlert(alert, "Handicapped accessibility details have been saved.", 'success', true);
							$('.remove').click();
							populateCarousel(parsed, $('#handicap-carousel'));
							$('#handicap-details-well').html(details.val());
							$('.fa-ticket').addClass('ready');

							progressBar.hide();
							progressBar.children().css('width', '0%');
						});
					}
				});
			});
		});

		$('#prize-this-venue').click(function() {
            {% if not is_recipient %}
				document.location = '/venues/recipient/{{ venue.id }}';
            {% else %}
                var priceInput = $('#price'), textSpan = $(this).find('span'), currentPrice = $('#current-price'), icon = $(this).find('i'), input = $('.input-prepend');

                currentPrice.hide();
                input.show();

                if (textSpan.text() == 'Save') {
                    icon.removeClass('fa-save').addClass('fa-spin fa-spinner');
                    var response = $.post('/venues/save_price/{{ venue.id }}', {
                        'price' : priceInput.val() ? priceInput.val() : '0'
                    });

                    response.done(function() {
                        icon.removeClass('fa-spin fa-spinner').addClass('fa-usd');
                        textSpan.text('Price this Venue');
                        input.hide();
                        currentPrice.show();
                        currentPrice.find('span').html(priceInput.val());
                        priceInput.parent().css('display', 'none');
                    });

                } else {
                    priceInput.parent().css('display', 'table');
                    $(this).data('original_text', $(this).html());
                    textSpan.text('Save');
                    icon.removeClass('fa-usd').addClass('fa-save');
                }
            {% endif %}
		});

		$('#send-message').click(function() {

            //The following 4 lines are bot protection, a bot will fill out the hidden email field while a human wont
            var $button = $(this);
            var email = $button.parents('form:first').find('#email-field').val();
            if (email > "")
                return;

			var message = $('[name="message"]').val(),
                alert = $('.contents').find('.alert');

			var response = $.post('/venues/send_message/{{ venue.id }}', {
				'message' : message
			});

			response.done(function() {
                showAlert(alert, 'Message has been sent!', 'success', true)
			});
		});

		function setNearestHospitals(hospitalSelect) {
			if (!hospitalSelect.hasClass('loaded')) {
				var lng = window.currentVenueLongitude,
					ltd = window.currentVenueLatitude;

				var loading = $('#loading-nearest');

				loading.removeClass('hidden');

				$.get('/hospitals/get_hospitals_within_bounds', {
						'longitude_range' : [lng - 0.15, lng + 0.15], 'latitude_range' : [ltd - 0.15, ltd + 0.15]
					}, function(data) {
						var parsed = JSON.parse(data).hospitals;

						loading.addClass('hidden');

						$.each(parsed, function() {
							var option = $('<option></option>');

							option.html(this.name);
							option.val(this.id);
							hospitalSelect.append(option);

							hospitals[this.id] = this;
						});
						hospitalSelect.addClass('loaded');
				});
			}
		}

		hospitalSelect.change(function() {
			if (hospitalSelect.hasClass('loaded')) {
				var id = $(this).val(),
					isPresent = id in hospitals;

				if (isPresent) {
					var address = $('#medical-details form input[name="address"]'),
						city = $('#medical-details form input[name="city"]'),
						state = $('#medical-details form select[name="state"]'),
						zip = $('#medical-details form input[name="zip"]'),
						hospital = hospitals[id];

					address.val(hospital.address);
					city.val(hospital.city);
					state.val(hospital.state);
					zip.val(hospital.zip);
				}
			}
		});

		$('.carousel').on('slide', function() {
			if (window.isEditMode) {
				$(this).find('.remove-pic').hide();
                $(this).find('.pin-pic').hide();
			}
		});

		$('.carousel').on('slid', function() {
			if (window.isEditMode) {
				$(this).find('.remove-pic').show();
				setRemoveButtonPosition($(this).attr('id'));
			}
			else {
                $(this).find('.pin-pic').show()
			    setPinButtonPosition($(this).attr('id'));
			}
		});

{#    });#}

    function click_nav_button(name){
        // To get the correct button, since we have two rows of buttons which toggle being shown/hidden (gets not hidden button)
        $('a[opentab="' + name + '"]').filter(function(){return $(this).parents('.btn-group').css('display') != 'none'}).click()
    }

    $('#previous').click(function(){
        var active = $('.content.active').attr('id');

        if (active == "map") click_nav_button('#spuds');
        else if (active == "parking-details") click_nav_button('#map');
        else if (active == "up-to-5-pics") click_nav_button('#parking-details');
        else if (active == "video") click_nav_button('#up-to-5-pics');
        else if (active == "playing-surface") click_nav_button('#video');
        else if (active == "restroom-details") click_nav_button('#playing-surface');
        else if (active == "concession-details") click_nav_button('#restroom-details');
        else if (active == "admission-details") click_nav_button('#concession-details');
        else if (active == "medical-details") click_nav_button('#admission-details');
        else if (active == "handicap-details") click_nav_button('#medical-details');
    });

    $('#next').click(function(){
        var active = $('.content.active').attr('id');

        if (active == "spuds") click_nav_button('#map');
        else if (active == "map") click_nav_button('#parking-details');
        else if (active == "parking-details") click_nav_button('#up-to-5-pics');
        else if (active == "up-to-5-pics") click_nav_button('#video');
        else if (active == "video") click_nav_button('#playing-surface');
        else if (active == "playing-surface") click_nav_button('#restroom-details');
        else if (active == "restroom-details") click_nav_button('#concession-details');
        else if (active == "concession-details") click_nav_button('#admission-details');
        else if (active == "admission-details") click_nav_button('#medical-details');
        else if (active == "medical-details") click_nav_button('#handicap-details');
    });
    });


    function removeAssociation(teamID, teamName){
        if (confirm('This will remove the association with the team ' + teamName + '. Are you sure you want to do that?')){
            window.location = '/team/associate/' + teamID + '/remove/' + {{ venue.id }} + '?next={{ request.get_full_path }}';
        }
    }

    {% if not venue.location_has_been_changed %}
        $('#edit-venue-location-button').click(function(){
            $(this).parent().hide();
            $('#edit-venue-location').show()
        });

        $('#place-map-marker').click(function(){
            if (marker){
                marker.setPosition(map.getCenter());
            }
            else {
                marker = new google.maps.Marker({
                    position: map.getCenter(),
                    map: map,
                    title: 'New Venue Location'
                });
            }
            var alert = $('#location-alert');
            showAlert(alert,'Please wait while we check this location...', 'info');

            function checkNearbyVenues(latlng, alertContainer, successHandler){
                getVenuesWithinBounds().done(function(data) {
                    var venues = JSON.parse(data).venues,
                        otherVenueInRange = null;

                    $.each(venues, function() {
                        var distance = google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(this.latitude, this.longitude), latlng);
                        if (distance <= 250 && this.sport == "{{ venue.sport }}" && this.id != {{ venue.id }}) {
                            otherVenueInRange = this;
                            return false;
                        }
                    });

                    if (otherVenueInRange) {
                        var venueLink = '<a href="/venues/view/'
                                        + otherVenueInRange.id
                                        + '">'
                                        + otherVenueInRange.aka_name
                                        + '</a>';
                        showAlert(alertContainer, 'A {{ venue.sport }} venue already exists within 250m of where you want to move your venue to: ' + venueLink + '<br/>Please move the map to another location and click "Place Map Marker" again to move the venue.', 'warning', false);
                    } else {
                        successHandler(pos.latitude, pos.longitude);
                    }
                });
            }

            checkNearbyVenues(marker.position, alert, function(latitude, longitude){
                var distance = google.maps.geometry.spherical.computeDistanceBetween(map.getCenter(), new google.maps.LatLng(window.currentVenueLatitude, window.currentVenueLongitude));
                if (distance <= 1000){
                    showAlert(alert, '<p>You only get <b>ONE</b> chance to change the location! If you are 100% satisfied with the new location, centered on the red marker, you can:</p>' +
                                     '<p><a class="btn btn-primary" href="javascript:saveVenueLocation()">Save Updated Location</a></p>', 'success');
                }
                else{
                    showAlert(alert, '<p>Oops! You cannot move your venue more than 1000 meters from the original location (You are ' + Math.round(distance) + ' meters away.)', 'danger');
                }
            });


        });

        function saveVenueLocation(){
            var response = $.post('/venues/save_coordinates/{{ venue.id }}',
                                  {
                                      'latitude': marker.position.lat(),
                                      'longitude': marker.position.lng()
                                  });
            response.done(function(){
                $('#edit-venue-location').hide();
                showAlert($('#location-alert'), 'You have successfully changed the location of your venue!', 'success');
            })
        }
    {% endif %}


</script>
{% endblock %}
