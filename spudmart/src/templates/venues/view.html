{% extends 'CERN/base.html' %}

{% load displays %}

{% block meta %}

<link rel="stylesheet" href="/media/dashboard/css/ace-file-input.css" />
<title>{{ venue.name }} ({{ venue.sport }}) | Spudder - Sports Updates Made Simple</title>

<!--Facebook meta tags-->
{% if venue.aka_name and venue.sport %}
<meta property="og:title" content="{{ venue.aka_name }} ({{ venue.sport }}) | Spudder - Sports Updates Made Simple">
<meta property="og:description" content="See details about this field on Spudder.">
{% endif %}
<meta property="og:url" content="http://{{ request.META.HTTP_HOST }}{{ request.path }}">
<meta property="og:site_name" content="Spudder - Sports Updates Made Simple">
{% if venue.logo %}<meta property="og:image" content="http://{{ request.META.HTTP_HOST }}/file/serve/{{ venue.logo.id }}">
    {% else %}<meta property="og:image" content="http://{{ request.META.HTTP_HOST }}/ico/favicon.png">
{% endif %}
<meta propety="og:type" content="website">
<!--Twitter meta tags-->
<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@spudder_com">

{% endblock meta %}

{% block content %}
<div class="container clearfix" id="venue-view">
	<div class="row">
		<div class="span8">
			<form method="post" enctype="multipart/form-data">
					{% if can_edit %}
						<div class="pull-right">
							<div class="btn btn-orange" id="edit">
                                Edit Mode
							</div>
						</div>
					{% endif %}


				<div class="row-fluid view-mode" style="width: 100%;">
					<div class="span2" style="float: left; width: 120px;">
						{% if venue.logo %}
							<img id="venue-logo" src="/file/serve/{{ venue.logo.id }}" />
						{% else %}

							<div class="logo-placeholder bigger" style=
							"line-height: 175%;" id="placeholder1">

								Your Logo Here
							</div>
						{% endif %}
					</div>
					<div style="display: inline-block; text-align: center; width: 75%; margin-top:10px;">
						<h3 style="margin-bottom: 0px; font-weight: bold;" id="venue-name"> 

						{% if sponsor %}
							{{ sponsor.name }}
						{% else %}
							{{ venue.name }}
						{% endif %}
						</h3>
						<h5 class="view-mode" id="venue-aka-name">
						{% if venue.aka_name %}
							{{ venue.aka_name }}
						{% else %}
							Common Venue Name
						{% endif %}
						</h5>
					</div>
				</div>

				<div class="alert"></div>

				<div class="row-fluid edit-mode edit-mode-sponsor">
					<div class="span4">
						<input type="file" name="file" id="edit-logo" />
					</div>
					<div class="span8 edit-mode edit-mode-sponsor">
						<input type="text" name="name"
						value="{% if venue.name %}{{ venue.name }}{% else %}This could be Your company{% endif %}" />
					</div>
				</div>

				<h4 class="edit-mode">
					<input type="text" name="aka_name"
					value="{% if venue.aka_name %}{{ venue.aka_name }}{% else %}Common Venue Name{% endif %}" />
				</h4>

				<div class="edit-mode edit-mode-sponsor">
					<div class="btn btn-orange" id="save-name">
						Save
					</div>
				</div>
			</form>

			<!--<div style="position: absolute;">
				{% include 'venues/parts/buttons_top.html' %}
			</div>-->
			<div style="height: 362px; margin: 0 auto; width: 100%; vertical-align: middle; text-align: center;">
			<div class="row-fluid" style="height:100%;">
				<div class="span12 contents" style="height:100%;">
					<div class="alert"></div>
					<div id="venue-promo-video" class="active content">
						<iframe width="100%" height="100%" src="//www.youtube.com/embed/H72B-GCMohs?rel=0"
						frameborder="0"
						allowfullscreen></iframe>
					</div>
					<div class="content" id="map">
						<div id="map-canvas">

						</div>

						<a id="save-location" class="btn btn-orange edit-mode hidden">Save</a>
						<div class="buttons" id="flagcontent" style="float:right;">
							<i class="map-icon-embassy" title="FlagContent" style="width: 80%; font-size: 10pt; height: 13px;line-height: 13px;"> 
								FLAG THIS 
							</i>
						</div>

					</div>
					<div id="parking-details" class="content">
						<div class="row-fluid edit-mode">
							<div class="span6">
								<p>
									Parking Details
								</p>
								<textarea name="parking-details" placeholder="Enter parking details">{{ venue.parking_details }}</textarea>
							</div>
							<div class="span6">
								<p>
									Local Parking Tips
								</p>
								<textarea name="parking-tips" placeholder="Insider tips to where to park">{{ venue.parking_tips }}</textarea>
							</div>
							<a id="save-parking-details" class="btn btn-orange">Save</a>
						</div>
						<div class="row-fluid view-mode">
							<div class="span6">
								<p>
									Parking Details
								</p>
								<div class="well" id="venue-parking-details">
									{{ venue.parking_details }}
								</div>
							</div>
							<div class="span6">
								<p>
									Local Parking Tips
								</p>
								<div class="well" id="venue-parking-tips">
									{{ venue.parking_tips }}
								</div>
							</div>
						</div>
					</div>
					<div id="up-to-5-pics" class="content">
						<div class="row-fluid edit-mode margin-bottom20">
							<form method="post" enctype="multipart/form-data">
								<div class="span6">
									<p>
										Select up to 5 pictures and upload them
									</p>
									<input type="file" name="file" multiple="multiple" />
									<a id="upload-up-to-5-pics" class="btn btn-orange pull-left">Upload</a>
									<div class="progress progress-striped">
										<div class="bar"> </div>
									</div>
								</div>
							</form>
						</div>
						<div class="row-fluid">
							<div class="{% if not venue.venue_pics %}hidden{% endif %} carousel slide" id="venue-pics-carousel">
								<div class="carousel-inner">
									{% for pic in venue.venue_pics %}
									<div class="{% if forloop.counter == 1 %}active{% endif %} item">
										<img src="{{ pic }}" />
									</div>
									{% endfor %}
								</div>
								<a href="#venue-pics-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
								<a href="#venue-pics-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

								<div class="btn btn-danger remove-pic edit-mode" id="venue_pics">Remove</div>
							</div>
						</div>
					</div>
					<div id="video" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Paste Youtube embed code here
							</p>
							<form method="post" class="form-horizontal">
								<textarea name="video" placeholder="Youtube video's embed code">{{ venue.video }}</textarea>
								<div>
									<a id="save-video" class="btn btn-orange">Save</a>
								</div>
							</form>
						</div>
						<div class="row-fluid view-mode" id="venue-video" style="height:100%;">
							{{ venue.video|safe|default:'<iframe width="100%" height="100%" src="//www.youtube.com/embed/Fde3tYVcuGc?rel=0" frameborder="0" allowfullscreen></iframe>' }}
						</div>
					</div>
					<div id="playing-surface" class="content">
						<div class="row-fluid edit-mode">
							<form method="post" enctype="multipart/form-data">
								<div class="span6">
									<p>
										Select up to 5 pictures of playing surface and upload them
									</p>
									<input type="file" name="file" multiple="multiple" />
								</div>
								<div class="span6">
									<p>
										Playing surface details
									</p>
									<textarea placeholder="Enter playing surface details" name="details">{{ venue.playing_surface_details }}</textarea>
								</div>
								<div>
									<a id="upload-playing-surface" class="btn btn-orange pull-left">Upload</a>
									<div class="progress progress-striped">
										<div class="bar"> </div>
									</div>
								</div>
							</form>
						</div>
						<div class="row-fluid" style="height: 70%; width: 70%; margin: 0 auto;">
							<div class="carousel slide {% if not venue.playing_surface_pics %}hidden{% endif %}" id="playing-surface-carousel" style="max-width: 95%; margin: 0 auto;">
								<div class="carousel-inner">
									{% for pic in venue.playing_surface_pics %}
									<div class="{% if forloop.counter == 1 %}active{% endif %} item">
										<img src="{{ pic }}" />
									</div>
									{% endfor %}
								</div>
								<a href="#playing-surface-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
								<a href="#playing-surface-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

								<div class="btn btn-danger remove-pic edit-mode" id="playing_surface_pics">Remove</div>
							</div>

							<div class="span6 well" id="venue-playing-surface-details" style="width: 95%; margin: 0 auto; float: none;">
								{{ venue.playing_surface_details }}
							</div>
						</div>
					</div>
					<div id="flag-content" class="content">
						<div class="row-fluid">
							<form method="post">
								<p>
									Send message to Groundskeeper
								</p>
								<textarea placeholder="Message content" name="message"></textarea>
								<div>
									<a id="send-message" class="btn btn-orange">Contact Groundskeeper</a>
								</div>
							</form>
						</div>
					</div>
					<div id="restroom-details" class="content">
						<div class="row-fluid edit-mode">
							<form method="post" class="form-horizontal" enctype="multipart/form-data">
								<div class="span6">
									<p>
										You can select up to 5 pictures of restroom and upload them
									</p>
									<input type="file" name="file" multiple="multiple" />
								</div>
								<div class="span6">
									<p>
										Restroom Details
									</p>
									<textarea placeholder="Enter restroom details" name="details">{{ venue.restroom_details }}</textarea>
								</div>
								<div>
									<a id="save-restroom-details" class="btn btn-orange pull-left">Save</a>
									<div class="progress progress-striped">
										<div class="bar"> </div>
									</div>
								</div>
							</form>
						</div>
						<div class="row-fluid">
							<div class="carousel slide {% if not venue.restroom_pics %}hidden{% endif %}" id="restroom-carousel">
								<div class="carousel-inner">
									{% for pic in venue.restroom_pics %}
									<div class="{% if forloop.counter == 1 %}active{% endif %} item">
										<img src="{{ pic }}" />
									</div>
									{% endfor %}
								</div>
								<a href="#restroom-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
								<a href="#restroom-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>

								<div class="btn btn-danger remove-pic edit-mode" id="restroom_pics">Remove</div>
							</div>
							<p>
								Restroom Details
							</p>
							<div class="well span6 nomargin" id="venue-restroom-details" style="width: 100%;">
								{{ venue.restroom_details }}
							</div>
						</div>
					</div>
					<div id="concession-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Concession Details
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter concession details" name="details">{{ venue.concession_details }}</textarea>
								<p>
									<a id="save-concession-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Concession Details
							</p>
							<div class="well span6 nomargin" id="venue-concession-details" style="width:100%;">
								{{ venue.concession_details }}
							</div>
						</div>
					</div>
					<div id="admission-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Admission &amp; Seating Details
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter seating details" name="details">{{ venue.admission_details }}</textarea>
								<p>
									<a id="save-admission-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Admission Details
							</p>
							<div class="well span6 nomargin" id="venue-admission-details" style="width:100%;">
								{{ venue.admission_details }}
							</div>
						</div>
					</div>
					<div id="shelter-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Available Shelter Details
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter details about shelter and protection from elements" name="details">{{ venue.shelter_details }}</textarea>
								<p>
									<a id="save-shelter-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Shelter Details
							</p>
							<div class="well span6 nomargin" id="venue-shelter-details" style="width:100%;">
								{{ venue.shelter_details }}
							</div>
						</div>
					</div>
					<div id="medical-details" class="content">
						<div class="row-fluid edit-mode">
							<form method="post" class="form-horizontal">
								<div class="span6">
									<p>
										Available Medical Details
									</p>
									<textarea placeholder="Enter details about medical" name="details">{{ venue.medical_details }}</textarea>
								</div>
								<div class="span6" style="width:100%;">
									<p>
										Address of nearby facility
									</p>
									<label>Nearest Hospitals</label>
									<select name="hospital">
										<option>---</option>
									</select> <img id="loading-nearest" class="hidden" src="/media/img/ajax-loader.gif" />
									<label>Address</label>
									<input type="text" placeholder="address" name="address" value="{{ medical_address.address }}"/>
									<label>City</label>
									<input type="text" placeholder="city" name="city" value="{{ medical_address.city }}" />
									<label>State</label>
									{% include 'commons/select_state.html' %}
									<label>Zip</label>
									<input type="text" placeholder="zip" name="zip" value="{{ medical_address.zip }}" />
								</div>
								<p>
									<a id="save-medical-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<div class="span6" style="width:100%;">
								<p>
									Address of nearby facility
								</p>
								<div class="well" style="width:100%;">
									<a href="http://maps.google.com/?q={{ venue.medical_address }}" target="_blank" id="venue-medical-address"> 
						                {{ venue.medical_address }}
						            </a>
								</div>
							</div>
						</div>
					</div>
					<div id="handicap-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Handicap Accessible
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter details about handicap accessible" name="details">{{ venue.handicap_details }}</textarea>
								<p>
									<a id="save-handicap-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Handicap Details
							</p>
							<div class="well span6 nomargin" id="venue-handicap-details" style="width:100%;">
								{{ venue.handicap_details }}
							</div>
						</div>
					</div>
				</div>
			</div>
			</div>

			<div style="width: 100%; margin: 0 auto; text-align: center;">
				{% include 'venues/parts/buttons_bottom.html' %}
			</div>
		
		</div>

		<div class="span4">
			<aside class="right-sidebar">
				<div class="widget offer-widget">
					<h5 class="widgetheading">
					<div class="row-fluid no-margin">
					<div class="span6" style="float:left; width: 120px; font-size:10pt;">
<!--
						<div class="span12" id="venue-name2">
							{% if sponsor %}
								{{ sponsor.name }}
							{% else %}
								{{ venue.name }}
							{% endif %}
						</div>
						<div class="span12">
							<small id="venue-aka-name2">
								{{ venue.aka_name }}
							</small>
						</div>
					</div></h5>

					<div class="row-fluid">
						<div class="span6">
-->
							{% if sponsor and sponsor.thumbnail %}
								<a href="/sponsor/{{ sponsor.id }}" target="_blank">
									<img id="venue-logo2" src="/file/serve/{{ sponsor.thumbnail }}" />
								</a>
							{% else %}
								{% if venue.logo %}
									<img id="venue-logo2" src="/file/serve/{{ venue.logo.id }}" />
								{% else %}
									<div class="logo-placeholder" style="width:45%; font-size: 1.5em;" id="placeholder2">
										Your Logo Here
									</div>
								{% endif %}
							{% endif %}
						</div>
						<div class="span12" id="venue-name2" style="text-align: center; width: 60%; margin-top:38px;">
							{% if sponsor %}
								{{ sponsor.name }}
							{% else %}
								{{ venue.name }}
							{% endif %}
						</div>
					</div></h5>

					<div class="row-fluid" style="float:left;">
						
						{% if not venue.renter %}
						
							{% if request.user == venue.user %}
							<div class="btn btn-orange" id="prize-this-venue">
								Price this Venue
							</div>
							<div class="input-prepend">
								<span class="add-on">$</span>
								<input name="price" id="price" type="text" class="input-small" value="{{ venue.price }}" />
							</div>
							<div class="alert"></div>
							{% else %}
								<div id="current-price" style="text-align: left;">
								Name and sponsor this field for:
								<span>${{ venue.price }}</span>
								annually
								</div>
								{% if venue.price > 0.0 %}
								<div class="span6" id="price-column" style="width:100%; float: right;">
									{% if rent_venue_url %}
										<a href="{{ rent_venue_url }}"><img src="/media/img/buttons/pay-with-amazon.png" /></a>
									{% else %}
										<a href="/accounts/login?next={{ rent_venue_url }}" style="float: right;"><img src="/media/img/buttons/pay-with-amazon.png" /></a>
									{% endif %}
								{% endif %}
							{% endif %}							
						</div>
						{% endif %}
					</div>

					<div class="row-fluid">
						<div class="span7 details-header">
							Support Venue's Sponsor
						</div>

						<ul class="span5 social-network">
							<li>
								<a href="/sponsor/{{ sponsor.id }}" target="_blank" data-placement="bottom" title="" 
								data-original-title="Sponsor Public profile"> <i class="icon-spudder-rounded" style="font-size:1.65em;"> </i> </a>
							</li>

							<li>
								<a href="{{ sponsor.instagram }}" target="_blank" data-placement="bottom" title="" 
								data-original-title="Sponsor Instagram profile"> <i class="fa fa-instagram fa-2x"> </i> </a>
							</li>

							<li>
								<a href="{{ sponsor.facebook }}" target="_blank" data-placement="bottom" title="" 
								data-original-title="Sponsor Facebook profile"> <i class="fa fa-facebook-square fa-2x"> </i> </a>
							</li>

							<li>
								<a href="{{ sponsor.twitter }}" target="_blank" data-placement="bottom" title="" 
								data-original-title="Sponsor Twitter profile"> <i class="fa fa-twitter-square fa-2x"> </i> </a>
							</li>

							<li>
								<a href="{{ sponsor.google_plus }}" target="_blank" rel="publisher" data-placement="bottom" title="" 
								data-original-title="Sponsor Google+ profile"> <i class="fa fa-google-plus-square fa-2x"> </i> </a>
							</li>
						</ul>
					</div>

					<ul class="folio-detail offer-details">
						{% if venue.renter %}
							<li>
								<label>Speciality: </label> {{ sponsor.speciality }}
							</li>

							<li>
								<label>Location: </label> {{ sponsor.location }}
							</li>

							<li>
								<label>Phone: </label> {{ sponsor.phone }}
							</li>

							<li>
								<label>E-mail: </label> {{ sponsor.email }}
							</li>

							<li>
								<label>Website: </label> {{ sponsor.website }}
							</li>

							<li>
								<label>Fax: </label> {{ sponsor.fax }}
							</li>
						{% else %}
							<li>
								<label>Speciality: </label> Your company's info
							</li>

							<li>
								<label>Location: </label> Your company's location
							</li>

							<li>
								<label>Phone: </label> Your company's phone
							</li>

							<li>
								<label>E-mail: </label> Your company's e-mail
							</li>

							<li>
								<label>Website: </label> Your company's website
							</li>

							<li>
								<label>Fax: </label> Your company's fax
							</li>
						{% endif %}
					</ul>
				</div>
			</aside>
		</div>
	</div>

</div>
{% endblock content %}

{% block scripts %}
<script type="text/javascript" src="/media/js/venues/utils.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=geometry"></script>
<script type="text/javascript" src="/media/js/google.map.js"></script>
<script type="text/javascript" src="/media/js/jquery.serialize.file.js"></script>
<script type="text/javascript" src="/media/dashboard/js/ace-elements.min.js"></script>
<script type="text/javascript" src="/media/dashboard/js/ace.min.js"></script>
<script type="text/javascript" src="/media/dashboard/js/jquery-ui-1.10.3.custom.min.js"></script>
<script type="text/javascript" src="/media/js/parseUri.js"></script>
<script type="text/javascript">
    window.venueName = "{{ venue.name }}";
	window.currentVenueLongitude = parseFloat("{{ venue.longitude }}");
	window.currentVenueId = "{{ venue.id }}";
	window.currentVenueLatitude = parseFloat("{{ venue.latitude }}");
	window.preloadedOrange = $('<img src="/media/img/ajax-loader-orange.gif" />');
	window.preloadedBlack = $('<img src="/media/img/ajax-loader-black.gif" />');
	window.isEditMode = false;
	window.currentSelectedSport = '{{ venue.sport }}';

	$(document).ready(function() {
        $('.alert').each(function(i, alert) {
           var $alert = $(alert);
           if ($alert.html() == "")
               $alert.hide();
        });

		var hospitalSelect = $('[name="hospital"]'),
			hospitals = {};

		$('select[name="state"]').val('{{medical_address.state}}');

		$('#venue-pics-carousel, #playing-surface-carousel').carousel({
			interval : false
		});

		var editMode = $('{% if is_sponsor %}.edit-mode-sponsor{% else %}.edit-mode{% endif %}'),
			viewMode = $('.view-mode'),
			buttons = $('.buttons'),
			icons = buttons.find('i');

		$('#edit').click(function() {
			if ($(this).html() == 'Show Mode') {
				editMode.hide();
				viewMode.show();
				buttons.addClass('no-border');
				$(this).html('Edit Mode');
				window.isEditMode = false;
			} else {
				editMode.show();
				viewMode.hide();
				buttons.removeClass('no-border');
				$(this).html('Show Mode');
				window.isEditMode = true;
			}
		});

		$(buttons).disableSelection();

		function show(element) {
			$('.contents > .active').removeClass('active');
			$(element).addClass('active');
			$(element).animate({
				'margin-left' : '0px'
			}, '1000');
			$(element).show();
		}

		function hide(elements) {
			$.each(elements, function() {
				$(this).css({
					'margin-left' : '-1000px',
					'display' : 'none'
				});
			});
		}
		
		

		
		
		icons.click(function() {
			if(!$(this).hasClass('active')) {
				var currentTab = $(this).parent().attr('openTab');

				$('.alert').hide();

				$('.buttons i.active').removeClass('active');

				hide($('.contents > div.content'));
			
				$(this).addClass('active');
				
				show(currentTab);
			}
			
			if ($(this).hasClass('map-icon-postal-code')) {

				if (!$(this).hasClass('initialized')) {
					initialize(false, $('.contents .alert'), function(venue) {
						return
							venue.sport == window.currentSelectedSport
							&& venue.id != parseInt(window.currentVenueId, 10);
					}, function() {
						//$('#save-location').removeClass('hidden');
					});
				}
			} else if ($(this).hasClass('map-icon-health')) {
				setNearestHospitals(hospitalSelect);
			} else if ($(this).hasClass('map-icon-point-of-interest')) {
				setRemoveButtonPosition('venue-pics-carousel');
			} else if ($(this).hasClass('icon-grass')) {
				setRemoveButtonPosition('playing-surface-carousel');
			} else if ($(this).hasClass('map-icon-toilet')) {
				setRemoveButtonPosition('restroom-carousel');
			}

		});

		$('#save-parking-details').click(function() {
			var button = $(this), parkingDetails = $('[name="parking-details"]'), parkingTips = $('[name="parking-tips"]'),
				dfd = saving($(this), $('.contents').find('.alert'), 'Parking details has been saved');

			var response = $.post('/venues/save_parking_details/{{ venue.id }}', {
				'parking-details' : parkingDetails.val(),
				'parking-tips' : parkingTips.val()
			});

			response.done(function() {
				$('.map-icon-parking').addClass('ready');
				
				$('#venue-parking-details').html(parkingDetails.val());
				$('#venue-parking-tips').html(parkingTips.val());

				dfd.resolve();
			});
		});

		function setRemoveButtonPosition(carousel_ID) {
			var active = $('#' + carousel_ID + ' .item.active img');
			$('#' + carousel_ID + ' .remove-pic').css('right', 10 + parseInt(active.css('marginRight'), 10) + 'px');
		}

		$('.remove-pic').click(function() {
			var carousel = $(this).parent(),
				listType = $(this).attr('id'),
				active = carousel.find('.active'),
				fileURL = active.find('img').attr('src');

			$(this).hide();

			var response = $.post('/venues/remove_pic/{{ venue.id }}', {
				'list_type' : listType,
				'file_url' : fileURL
			});

			carousel.carousel('next');
			active.remove();
			if (carousel.find('.item').length == 0) {
				carousel.hide();
			}
			$(this).show();
			showAlert($('.contents .alert'), 'Image has been removed', 'success', true);
		});

		$('#up-to-5-pics input, #playing-surface input, #restroom-details input').ace_file_input({
			style : 'well',
			btn_choose : 'Click to add images',//'Drop files here or click to choose',
			btn_change : null,
			no_icon : 'icon-cloud-upload',
			//droppable : true,
			thumbnail : 'small',
			//icon_remove:null,//set null, to hide remove/reset button
			/**before_change: function(files, dropped) {
			 //Check an example below
			 //or examples/file-upload.html
			 return true;
			 },*/
			/**,before_remove : function() {
			 return true;
			 },*/
			preview_error : function(filename, error_code) {
				//name of the file that failed
				//error_code values
				//1 = 'FILE_LOAD_FAILED',
				//2 = 'IMAGE_LOAD_FAILED',
				//3 = 'THUMBNAIL_FAILED'
				//alert(error_code);
			},
		});

		$('#edit-logo').ace_file_input({
			no_file : 'No File ...',
			btn_choose : 'Choose',
			btn_change : 'Change',
			droppable : false,
			onchange : null,
			thumbnail : false
		});

		function showProgress(progressBar) {
			var xhr = new window.XMLHttpRequest();
         	progressBar.css('display', 'inline-block');

     		xhr.upload.addEventListener('progress', function(evt){
     			 var percentComplete = evt.loaded / evt.total;

                 percentComplete = parseInt(percentComplete * 100);

                 progressBar.children().css('width', percentComplete + '%');
     		});

     		return xhr;
		}

		$('#upload-up-to-5-pics').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
				alert = $('.contents').find('.alert');

			if (filesList.length > 5 || (parseInt('{{ venue.venue_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than is available.', 'warning', true);
				return;
			}

			var dfd = saving($(this), alert, 'Venue pictures has been uploaded'),
				progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_venue_pics/{{ venue.id }}', {
							'venue_pics' : parsed['uploaded_files']
						});

						response.done(function(data) {
							dfd.resolve();
							$('.remove').trigger('click')

							var carousel = $('#up-to-5-pics .carousel');

							populateCarousel(parsed, carousel);
							progressBar.hide();
							progressBar.children().css('width', '1%');
							$('.map-icon-point-of-interest').addClass('ready');

						});
					}
				});
			});
		});

		function populateCarousel(parsed, carousel) {
			$.each(parsed['uploaded_files'], function() {
				var item = $('<div class="item"></div>'),
					img = $('<img />');

				img.attr('src', this);
				if(carousel.find('.item').length == 0) {
					item.addClass('active');
				}

				item.append(img);
				carousel.find('.carousel-inner').append(item);
			});

			carousel.removeClass('hidden');
			carousel.show();
			carousel.carousel().removeData();
			carousel.carousel({ interval: false });
		}

		$('#save-name').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files,
				name = $(form).find('[name="name"]').val(),
				akaName = $(form).find('[name="aka_name"]').val(),
				dfd = saving($(this), $(form).find('.alert'), 'Venue basic information has been saved'),
				sport = $('[name="sport"]').val();

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_logo_and_name/{{ venue.id }}', {
							'logo' : parsed['uploaded_files'],
							'name' : name,
							'aka_name' : akaName,
							'sport' : sport
						});

						response.done(function(data) {
							window.currentSelectedSport;
							window.venueName = name;

							$('#venue-name, #venue-name2').html(name);
							$('#venue-aka-name, #venue-aka-name2').html(akaName);
							if (parsed['uploaded_files'].length > 0) {
								$('#venue-logo, #venue-logo2').attr('src', parsed['uploaded_files'][0]);
								$('#placeholder1').text('Refresh to see logo')
								$().text('Refresh to see logo')
							}

							dfd.resolve();
							$('.remove').click()
						});
					}
				});
			});
		});

		$('#upload-playing-surface').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files;

			if (filesList.length > 5 || (parseInt('{{ venue.playing_surface_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than is available.', 'warning', true);
				return;
			}

			var dfd = saving($(this), $('.contents').find('.alert'), 'Playing surface pictures and details have been saved'),
				details = form.find('[name="details"]'),
				progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_playing_surface_pics/{{ venue.id }}', {
							'playing_surface_pics' : parsed['uploaded_files'],
							'playing_surface_details' : details.val()
						});

						response.done(function(data) {
							dfd.resolve();
							$('.remove').click()
							populateCarousel(parsed, $('#playing-surface-carousel'));
							$('#venue-playing-surface-details').html(details.val());
							$('.icon-seat').addClass('ready');
							
							progressBar.hide();
							progressBar.children().css('width', '0%');
						});
					}
				});
			});
		});


		$('#save-video').click(function() {
			var textarea = $('#video form textarea'), dfd = saving($(this), $('.contents .alert'), 'Youtube video has been saved');

			var response = $.post('/venues/save_video/{{ venue.id }}', {
				'video' : textarea.val()
			});

			response.done(function() {
                $('.remove').click()
				$('#venue-video').html(textarea.val());
				$('.fa fa-youtube-play').addClass('ready');
			});
		});

		$('#save-restroom-details').click(function() {
			var form = $(this).parents('form'),
				files = $(form).serializeFiles(),
				filesList = $(form).find('input')[0].files;

			if (filesList.length > 5 || (parseInt('{{ venue.restroom_pics|length }}', 10) + filesList.length) > 5) {
				showAlert(alert, 'You are trying to upload more pics than is available.', 'warning', true);
				return;
			}

			var dfd = saving($(this), $('.contents').find('.alert'), 'Restroom pictures and details have been saved'),
				details = form.find('[name="details"]'),
				progressBar = form.find('.progress');

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					xhr: function() {
                 		var xhr = showProgress(progressBar);

                 		return xhr;
                 	},
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_restroom_details/{{ venue.id }}', {
							'restroom_pics' : parsed['uploaded_files'],
							'restroom_details' : details.val()
						});

						response.done(function(data) {
							dfd.resolve();
							$('.remove').click()
							$('#venue-restroom-details').html(details.val());
							$('.map-icon-toilet').addClass('ready');
							populateCarousel(parsed, $('#playing-surface-carousel'));
							progressBar.hide();
							progressBar.children().css('width', '0%');
						});
					}
				});
			});
		});

		$('#save-concession-details').click(function() {
			var textarea = $('#concession-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Concession details has been saved');

			var response = $.post('/venues/save_concession_details/{{ venue.id }}', {
				'concession_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-concession-details').html(textarea.val());
				$('.map-icon-food').addClass('ready');
			});
		});

		$('#save-admission-details').click(function() {
			var textarea = $('#admission-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Admission details has been saved');

			var response = $.post('/venues/save_admission_details/{{ venue.id }}', {
				'admission_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-admission-details').html(textarea.val());
				$('.icon-seat').addClass('ready');
			});
		});

		$('#save-shelter-details').click(function() {
			var textarea = $('#shelter-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Shelter details has been saved');

			var response = $.post('/venues/save_shelter_details/{{ venue.id }}', {
				'shelter_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-shelter-details').html(textarea.val());
				$('.map-icon-roofing-contractor').addClass('ready');
			});
		});

		$('#save-medical-details').click(function() {
			var address = $('#medical-details form input[name="address"]'),
				city = $('#medical-details form input[name="city"]'),
				state = $('#medical-details form select[name="state"]'),
				zip = $('#medical-details form input[name="zip"]'),
				dfd = saving($(this), $('.contents .alert'), 'Medical address has been saved');

			var medicalAddress = address.val() + ', ' + city.val() + ', ' + state.val() + ', ' + zip.val();

			var response = $.post('/venues/save_medical_details/{{ venue.id }}', {
				'medical_address' : medicalAddress,
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-medical-address').html(medicalAddress);
				$('.map-icon-health').addClass('ready');
				$('#venue-medical-address').attr('href', 'http://maps.google.com/?q=' + medicalAddress);
			});
		});

		$('#save-handicap-details').click(function() {
			var textarea = $('#handicap-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Handicap details has been saved');

			var response = $.post('/venues/save_handicap_details/{{ venue.id }}', {
				'handicap_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-handicap-details').html(textarea.val());
				$('.map-icon-wheelchair').addClass('ready');
			});
		});

		/**$('#save-location').click(function() {
			var dfd = saving($(this), $('.contents .alert'), 'Location has been saved');

			var response = $.post('/venues/save_coordinates/{{ venue.id }}', {
				'latitude' : '' + window.map.getCenter().lat(),
				'longitude' : '' +  window.map.getCenter().lng()
			});

			response.done(function() {
				dfd.resolve();
				$('.buttons i.map-icon-postal-code').addClass('ready initialized');
			});
		});*/

		$('#prize-this-venue').click(function() {
			{% if not is_recipient %}
				document.location = '/venues/recipient/{{ venue.id }}';
				return;
			{% endif %}

			var priceInput = $('#price'), button = $(this), currentPrice = $('#current-price');

			currentPrice.hide();

			if ($(this).html() == 'Save') {
				var dfd = saving($(this), $(this).parent().find('.alert'), 'Price saved');
				var response = $.post('/venues/save_price/{{ venue.id }}', {
					'price' : priceInput.val() ? priceInput.val() : '0'
				});

				response.done(function() {
					dfd.resolve();
					$(button).html('Price this Venue');
					currentPrice.show();
					currentPrice.find('span').html(priceInput.val());
					priceInput.parent().css('display', 'none');
				});

			} else {
				priceInput.parent().css('display', 'table');
				$(this).html('Save');
			}
		});

		$('#send-message').click(function() {
			var message = $('[name="message"]').val(),
				dfd = saving($(this), $(this).parents('.contents').find('.alert'), 'Message has been sent');

			var response = $.post('/venues/send_message/{{ venue.id }}', {
				'message' : message
			});

			response.done(function() {
				dfd.resolve();
			});
		});

		function setNearestHospitals(hospitalSelect) {
			if (!hospitalSelect.hasClass('loaded')) {
				var lng = window.currentVenueLongitude,
					ltd = window.currentVenueLatitude;

				var loading = $('#loading-nearest');

				loading.removeClass('hidden');

				$.get('/hospitals/get_hospitals_within_bounds', {
						'longitude_range' : [lng - 0.15, lng + 0.15], 'latitude_range' : [ltd - 0.15, ltd + 0.15]
					}, function(data) {
						var parsed = JSON.parse(data).hospitals;

						loading.addClass('hidden');

						$.each(parsed, function() {
							var option = $('<option></option>');

							option.html(this.name);
							option.val(this.id);
							hospitalSelect.append(option);

							hospitals[this.id] = this;
						});
						hospitalSelect.addClass('loaded');
				});
			}
		}

		hospitalSelect.change(function() {
			if (hospitalSelect.hasClass('loaded')) {
				var id = $(this).val(),
					isPresent = id in hospitals;

				if (isPresent) {
					var address = $('#medical-details form input[name="address"]'),
						city = $('#medical-details form input[name="city"]'),
						state = $('#medical-details form select[name="state"]'),
						zip = $('#medical-details form input[name="zip"]'),
						hospital = hospitals[id];

					address.val(hospital.address);
					city.val(hospital.city);
					state.val(hospital.state);
					zip.val(hospital.zip);
				}
			}
		});

		$('.carousel').on('slide', function() {
			if (window.isEditMode) {
				$(this).find('.remove-pic').hide();
			}
		});

		$('.carousel').on('slid', function() {
			if (window.isEditMode) {
				$(this).find('.remove-pic').show();
				setRemoveButtonPosition($(this).attr('id'));
			}
		});

	});
</script>
{% endblock scripts %}
