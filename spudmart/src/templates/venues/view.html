{% extends 'base.html' %}

{% load displays %}

{% block meta %}
<link rel="stylesheet" href="/media/dashboard/css/ace-file-input.css" />
{% endblock meta %}

{% block content %}
<div class="container clearfix" id="venue-view">
	<div class="row">
		<div class="span8">
			<form method="post" enctype="multipart/form-data">
				<h5 class="venue-header clearfix">Venue {% include 'venues/parts/select_sport.html' %}
					{% if request.user and request.user.pk == venue.user.pk %}
						<div class="pull-right">
							<div class="btn btn-orange" id="edit">
								Edit Mode
							</div>
						</div> 
					{% endif %}
				</h5>

				<div class="row-fluid view-mode">
					<div class="span2">
						{% if venue.logo %}
							<img src="/file/serve/{{ venue.logo.id }}" id="venue-logo" />
						{% else %}
							<div class="logo-placeholder bigger">
								Your Logo Here
							</div>
						{% endif %}
					</div>
					<div class="span10">
						<h4 id="venue-name"> {% if venue.name %}
							{{ venue.name }}
						{% else %}
							This could be Your company
						{% endif %} 
						</h4>
					</div>
				</div>

				<div class="alert"></div>

				<div class="row-fluid edit-mode">
					<div class="span4">
						<input type="file" name="file" id="edit-logo" />
					</div>
					<div class="span8 edit-mode">
						<input type="text" name="name"
						value="{% if venue.name %}{{ venue.name }}{% else %}This could be Your company{% endif %}" />
					</div>
				</div>

				Common Venue Name:
				<h4 class="view-mode" id="venue-aka-name">
					{% if venue.aka_name %}
						{{ venue.aka_name }}
					{% else %}
						Common Venue Name
					{% endif %}
				</h4>

				<h4 class="edit-mode">
					<input type="text" name="aka_name"
					value="{% if venue.aka_name %}{{ venue.aka_name }}{% else %}Common Venue Name{% endif %}" />
				</h4>

				<div class="edit-mode">
					<div class="btn btn-orange" id="save-name">
						Save
					</div>
				</div>
			</form>

			<div class="row-fluid buttons no-margin no-border">
				{% include 'venues/parts/buttons_top.html' %}
			</div>

			<div class="row-fluid">
				<div class="span12 contents">
					<div class="alert"></div>
					<div id="venue-promo-video" class="active content">
						<iframe width="560" height="315" src="//www.youtube.com/embed/H72B-GCMohs?rel=0"
						frameborder="0"
						allowfullscreen></iframe>
					</div>
					<div class="content" id="map">
						<div id="map-canvas">

						</div>
						<a id="save-location" class="btn btn-orange edit-mode hidden">Save</a>
					</div>
					<div id="parking-details" class="content">
						<div class="row-fluid edit-mode">
							<div class="span6">
								<p>
									Parking Details
								</p>
								<textarea name="parking-details" placeholder="Enter parking details">{{ venue.parking_details }}</textarea>
							</div>
							<div class="span6">
								<p>
									Local Parking Tips
								</p>
								<textarea name="parking-tips" placeholder="Insider tips to where to park">{{ venue.parking_tips }}</textarea>
							</div>
							<a id="save-parking-details" class="btn btn-orange">Save</a>
						</div>
						<div class="row-fluid view-mode">
							<div class="span6">
								<p>
									Parking Details
								</p>
								<div class="well" id="venue-parking-details">
									{{ venue.parking_details }}
								</div>
							</div>
							<div class="span6">
								<p>
									Local Parking Tips
								</p>
								<div class="well" id="venue-parking-tips">
									{{ venue.parking_tips }}
								</div>
							</div>
						</div>
					</div>
					<div id="up-to-5-pics" class="content">
						<div class="row-fluid edit-mode margin-bottom20">
							<form method="post" enctype="multipart/form-data">
								<div class="span6">
									<p>
										Select up to 5 pictures and upload them
									</p>
									<input type="file" name="file" multiple="multiple" />
									<a id="upload-up-to-5-pics" class="btn btn-orange">Upload</a>
								</div>
							</form>
						</div>
						<div class="row-fluid">
							<div class="{% if not venue.venue_pics %}hidden{% endif %} carousel slide" id="venue-pics-carousel">
								<div class="carousel-inner">
									{% for pic in venue.venue_pics %}
									<div class="{% if forloop.counter == 1 %}active{% endif %} item">
										<img src="{{ pic }}" />
									</div>
									{% endfor %}
								</div>
								<a href="#venue-pics-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
								<a href="#venue-pics-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>
								
								<div class="btn btn-danger remove-pic edit-mode" id="venue_pics">Remove</div>
							</div>
						</div>
					</div>
					<div id="video" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Paste Youtube embed code here
							</p>
							<form method="post" class="form-horizontal">
								<textarea name="video" placeholder="Youtube video's embed code">{{ venue.video }}</textarea>
								<div>
									<a id="save-video" class="btn btn-orange">Save</a>
								</div>
							</form>
						</div>
						<div class="row-fluid view-mode" id="venue-video">
							{{ venue.video|safe }}
						</div>
					</div>
					<div id="playing-surface" class="content">
						<div class="row-fluid edit-mode">
							<form method="post" enctype="multipart/form-data">
								<div class="span6">
									<p>
										Select up to 5 pictures of playing surface and upload them
									</p>
									<input type="file" name="file" multiple="multiple" />
								</div>
								<div class="span6">
									<p>
										Playing surface details
									</p>
									<textarea placeholder="Enter playing surface details" name="details">{{ venue.playing_surface_details }}</textarea>
								</div>
								<div>
									<a id="upload-playing-surface" class="btn btn-orange">Upload</a>
								</div>
							</form>
						</div>
						<div class="row-fluid">
							<div class="carousel slide {% if not venue.playing_surface_pics %}hidden{% endif %}" id="playing-surface-carousel">
								<div class="carousel-inner">
									{% for pic in venue.playing_surface_pics %}
									<div class="{% if forloop.counter == 1 %}active{% endif %} item">
										<img src="{{ pic }}" />
									</div>
									{% endfor %}
								</div>
								<a href="#playing-surface-carousel" class="carousel-control left" data-slide="prev">&lsaquo;</a>
								<a href="#playing-surface-carousel" class="carousel-control right" data-slide="next">&rsaquo;</a>
								
								<div class="btn btn-danger remove-pic edit-mode" id="playing_surface_pics">Remove</div>
							</div>
							<div class="playing-surface-details well" id="venue-playing-surface-details">
								{{ venue.playing_surface_details }}
							</div>
						</div>
					</div>
					<div id="flag-content" class="content">
						<div class="row-fluid">
							<form method="post">
								<p>
									Send message to Groundskeeper
								</p>
								<textarea placeholder="Message content" name="message"></textarea>
								<div>
									<a id="send-message" class="btn btn-orange">Contact Groundskeeper</a>
								</div>
							</form>
						</div>
					</div>
					<div id="restroom-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Restroom Details
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter restroom details" name="details">{{ venue.restroom_details }}</textarea>
								<div>
									<a id="save-restroom-details" class="btn btn-orange">Save</a>
								</div>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Restroom Details
							</p>
							<div class="well span6 nomargin" id="venue-restroom-details">
								{{ venue.restroom_details }}
							</div>
						</div>
					</div>
					<div id="concession-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Concession Details
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter concession details" name="details">{{ venue.concession_details }}</textarea>
								<p>
									<a id="save-concession-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Concession Details
							</p>
							<div class="well span6 nomargin" id="venue-concession-details">
								{{ venue.concession_details }}
							</div>
						</div>
					</div>
					<div id="admission-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Seating Details
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter seating details" name="details">{{ venue.admission_details }}</textarea>
								<p>
									<a id="save-admission-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Admission Details
							</p>
							<div class="well span6 nomargin" id="venue-admission-details">
								{{ venue.admission_details }}
							</div>
						</div>
					</div>
					<div id="shelter-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Available Shelter Details
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter details about shelter and protection from elements" name="details">{{ venue.shelter_details }}</textarea>
								<p>
									<a id="save-shelter-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Shelter Details
							</p>
							<div class="well span6 nomargin" id="venue-shelter-details">
								{{ venue.shelter_details }}
							</div>
						</div>
					</div>
					<div id="medical-details" class="content">
						<div class="row-fluid edit-mode">
							<form method="post" class="form-horizontal">
								<div class="span6">
									<p>
										Available Medical Details
									</p>
									<textarea placeholder="Enter details about medical" name="details">{{ venue.medical_details }}</textarea>
								</div>
								<div class="span6">
									<p>
										Address of nearby facility
									</p>
									<label>Address</label>
									<input type="text" placeholder="address" name="address" value="{{ medical_address.address }}"/>
									<label>City</label>
									<input type="text" placeholder="city" name="city" value="{{ medical_address.city }}" />
									<label>State</label>
									<select name="state">
										<option>NY</option>
									</select>
									<label>Zip</label>
									<input type="text" placeholder="zip" name="zip" value="{{ medical_address.zip }}" />
								</div>
								<p>
									<a id="save-medical-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<div class="span6">
								<p>
									Available Medical Details
								</p>
								<div class="well" id="venue-medical-details">
									{{ venue.medical_details }}
								</div>
							</div>
							<div class="span6">
								<p>
									Address of nearby facility
								</p>
								<div class="well">
									<a href="http://maps.google.com/?q={{ venue.medical_address }}" target="_blank" id="venue-medical-address"> 
						                {{ venue.medical_address }}
						            </a>
								</div>
							</div>
						</div>
					</div>
					<div id="handicap-details" class="content">
						<div class="row-fluid edit-mode">
							<p>
								Handicap Accessible
							</p>
							<form method="post" class="form-horizontal">
								<textarea placeholder="Enter details about handicap accessible" name="details">{{ venue.handicap_details }}</textarea>
								<p>
									<a id="save-handicap-details" class="btn btn-orange">Save</a>
								</p>
							</form>
						</div>
						<div class="row-fluid view-mode">
							<p>
								Handicap Details
							</p>
							<div class="well span6 nomargin" id="venue-handicap-details">
								{{ venue.handicap_details }}
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="row-fluid buttons no-border">
				{% include 'venues/parts/buttons_bottom.html' %}
			</div>
		</div>

		<div class="span4">
			<aside class="right-sidebar">
				<div class="widget offer-widget">
					<h5 class="widgetheading">
					<div class="row-fluid no-margin">
						<div class="span12" id="venue-name2">
							{{ venue.name }}
						</div>
						<div class="span12">
							<small id="venue-aka-name2"> 
								{{ venue.aka_name }}
							</small>
						</div>
					</div></h5>

					<div class="row-fluid">
						<div class="span6">
							{% if venue.logo %}
								<img id="venue-logo2" src="/file/serve/{{ venue.logo.id }}" />
							{% else %}
								<div class="logo-placeholder">
									Your Logo Here
								</div>
							{% endif %}
						</div>
						<div class="span6 hidden" id="price-column">
							{% if request.user == venue.user %}
							<div class="btn btn-orange" id="prize-this-venue">
								Price this Venue
							</div>
							<div class="input-prepend">
								<span class="add-on">$</span>
								<input name="price" id="price" type="text" class="input-small" value="{{ venue.price }}" />
							</div>
							<div class="alert"></div>
							{% endif %}
							<div id="current-price">
								Name and sponsor this field for:
								${{ venue.price }}
								annually
							</div>
						</div>
					</div>

					<div class="row-fluid">

						<div class="span8 details-header">
							Support Venue's Sponsor
						</div>

						<ul class="span4 social-network">
							<li>
								<a href="" target="_blank" data-placement="bottom" title="" data-original-title="Venue Facebook profile"> <i class="icon-facebook icon-square"></i> </a>
							</li>

							<li>
								<a href="" target="_blank" data-placement="bottom" title="" data-original-title="Venue Twitter profile"> <i class="icon-twitter icon-square"></i> </a>
							</li>

							<li>
								<a href="" target="_blank" rel="publisher" data-placement="bottom" title="" data-original-title="Venue Google+ profile"> <i class="icon-google-plus icon-square"></i> </a>
							</li>

						</ul>
					</div>

					<ul class="folio-detail offer-details">
						<li>
							<label>Speciality: </label> Your company's info
						</li>

						<li>
							<label>Location: </label> Your company's location
						</li>

						<li>
							<label>Phone: </label> Your company's phone
						</li>

						<li>
							<label>E-mail: </label> Your company's e-mail
						</li>

						<li>
							<label>Website: </label> Your company's website
						</li>

						<li>
							<label>Fax: </label> Your company's fax
						</li>

					</ul>
				</div>

				<div class="widget donation-widget">

					<a href="https://karol-dot-spudmart1.appspot.com/dashboard/donation/KR1ZOOCbOY"> <img src="/media/img/buttons/pay-with-amazon.png"> </a>

				</div>
			</aside>
		</div>
	</div>

</div>
{% endblock content %}

{% block scripts %}
<script type="text/javascript" src="/media/js/venues/utils.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=geometry"></script>
<script type="text/javascript" src="/media/js/google.map.js"></script>
<script type="text/javascript" src="/media/js/jquery.serialize.file.js"></script>
<script type="text/javascript" src="/media/dashboard/js/ace-elements.min.js"></script>
<script type="text/javascript" src="/media/dashboard/js/ace.min.js"></script>
<script type="text/javascript" src="/media/dashboard/js/jquery-ui-1.10.3.custom.min.js"></script>
<script type="text/javascript" src="/media/js/parseUri.js"></script>
<script type="text/javascript">
	window.venueName = "{{ venue.name }}";
	window.currentVenueLongitude = "{{ venue.longitude }}";
	window.currentVenueLatitude = "{{ venue.latitude }}";
	window.preloadedOrange = $('<img src="/media/img/ajax-loader-orange.gif" />');
	window.preloadedBlack = $('<img src="/media/img/ajax-loader-black.gif" />');
	window.isEditMode = false;
	window.currentSelectedSport = '{{ venue.sport }}';

	$(document).ready(function() {
		function checkReadyContentsCount() {
			return window.setInterval(function() {
				if ($('.buttons .ready').length == 12) {
					$('#price-column').removeClass('hidden');
					window.clearInterval(checked);
				}
			}, 1000);
		};
		
		var checked = checkReadyContentsCount();

		$('#venue-pics-carousel, #playing-surface-carousel').carousel({
			interval : false
		});

		var editMode = $('.edit-mode'), viewMode = $('.view-mode'), buttons = $('.buttons'), icons = buttons.find('i');

		$('#edit').click(function() {
			if ($(this).html() == 'Show Mode') {
				editMode.hide();
				viewMode.show();
				buttons.addClass('no-border');
				$(this).html('Edit Mode');
				window.isEditMode = false;
			} else {
				editMode.show();
				viewMode.hide();
				buttons.removeClass('no-border');
				$(this).html('Show Mode');
				window.isEditMode = true;
			}
		});

		$(buttons).disableSelection();

		function show(element) {
			$('.contents > .active').removeClass('active');
			$(element).addClass('active');
			$(element).animate({
				'margin-left' : '0px'
			}, '1000');
			$(element).show();
		}

		function hide(elements) {
			$.each(elements, function() {
				$(this).css({
					'margin-left' : '-1000px',
					'display' : 'none'
				});
			});
		}


		icons.click(function() {
			var currentTab = $(this).parent().attr('openTab');

			$('.alert').hide();

			$('.buttons i.active').removeClass('active');

			hide($('.contents > div.content'));

			$(this).addClass('active');

			show(currentTab);

			if ($(this).hasClass('icon-map-marker')) {

				if (!$(this).hasClass('initialized')) {
					initialize(window.isEditMode);
				}
			}

		});

		$('#save-parking-details').click(function() {
			var button = $(this), parkingDetails = $('[name="parking-details"]'), parkingTips = $('[name="parking-tips"]'), 
				dfd = saving($(this), $('.contents').find('.alert'), 'Parking details has been saved');

			var response = $.post('/venues/save_parking_details/{{ venue.id }}', {
				'parking-details' : parkingDetails.val(),
				'parking-tips' : parkingTips.val()
			});

			response.done(function() {
				$('.icon-truck').addClass('ready');
				
				$('#venue-parking-details').html(parkingDetails.val());
				$('#venue-parking-tips').html(parkingTips.val());
				
				dfd.resolve();
			});
		});
		
		$('.remove-pic').click(function() {
			var carousel = $(this).parent(),
				listType = $(this).attr('id'),
				active = carousel.find('.active'),
				fileURL = active.find('img').attr('src');
			
			var response = $.post('/venues/remove_pic/{{ venue.id }}', {
				'list_type' : listType,
				'file_url' : fileURL
			});
			
			carousel.carousel('next');
			active.remove();
			if (carousel.find('.item').length == 0) {
				carousel.hide();
			}
			showAlert($('.contents .alert'), 'Image has been removed', 'success', true);
		});

		$('#up-to-5-pics input, #playing-surface input').ace_file_input({
			style : 'well',
			btn_choose : 'Drop files here or click to choose',
			btn_change : null,
			no_icon : 'icon-cloud-upload',
			droppable : true,
			thumbnail : 'small'
			//, icon_remove:null//set null, to hide remove/reset button
			/**,before_change:function(files, dropped) {
			 //Check an example below
			 //or examples/file-upload.html
			 return true;
			 }*/
			/**,before_remove : function() {
			 return true;
			 }*/
			,
			preview_error : function(filename, error_code) {
				//name of the file that failed
				//error_code values
				//1 = 'FILE_LOAD_FAILED',
				//2 = 'IMAGE_LOAD_FAILED',
				//3 = 'THUMBNAIL_FAILED'
				//alert(error_code);
			}
		});

		$('#edit-logo').ace_file_input({
			no_file : 'No File ...',
			btn_choose : 'Choose',
			btn_change : 'Change',
			droppable : false,
			onchange : null,
			thumbnail : false
		});

		$('#upload-up-to-5-pics').click(function() {
			var form = $(this).parents('form'), files = $(form).serializeFiles(), filesList = $(form).find('input')[0].files, dfd = saving($(this), $('.contents').find('.alert'), 'Venue pictures has been uploaded');

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_venue_pics/{{ venue.id }}', {
							'venue_pics' : parsed['uploaded_files']
						});

						response.done(function(data) {
							dfd.resolve();
							
							var carousel = $('#up-to-5-pics .carousel');
							
							populateCarousel(parsed, carousel);
							
							$('.icon-camera-retro').addClass('ready');
						});
					}
				});
			});
		});
		
		function populateCarousel(parsed, carousel) {
			$.each(parsed['uploaded_files'], function() {
				var item = $('<div class="item"></div>'),
					img = $('<img />');
				
				img.attr('src', this);
				if(carousel.find('.item').length == 0) {
					item.addClass('active');
				}
				
				item.append(img);
				carousel.find('.carousel-inner').append(item);
			});
			
			carousel.removeClass('hidden');
			carousel.show();
			carousel.carousel().removeData();
			carousel.carousel({ interval: false });
		}

		$('#save-name').click(function() {
			var form = $(this).parents('form'), 
				files = $(form).serializeFiles(), 
				filesList = $(form).find('input')[0].files, 
				name = $(form).find('[name="name"]').val(), 
				akaName = $(form).find('[name="aka_name"]').val(), 
				dfd = saving($(this), $(form).find('.alert'), 'Venue basic information has been saved'),
				sport = $('[name="sport"]').val();

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_logo_and_name/{{ venue.id }}', {
							'logo' : parsed['uploaded_files'],
							'name' : name,
							'aka_name' : akaName,
							'sport' : sport
						});

						response.done(function(data) {
							window.currentSelectedSport;
							
							$('#venue-name, #venue-name2').html(name);
							$('#venue-aka-name, #venue-aka-name2').html(akaName);
							if (parsed['uploaded_files'].length > 0) {
								$('#venue-logo, #venue-logo2').attr('src', parsed['uploaded_files'][0]);
							}
							
							dfd.resolve();
						});
					}
				});
			});
		});

		$('#upload-playing-surface').click(function() {
			var form = $(this).parents('form'), 
				files = $(form).serializeFiles(), 
				filesList = $(form).find('input')[0].files, 
				dfd = saving($(this), $('.contents').find('.alert'), 'Playing surface pictures and details have been saved'),
				details = form.find('[name="details"]');

			$.get('/upload/get_upload_url', function(data) {
				$.ajax({
					url : data,
					data : files,
					cache : false,
					contentType : false,
					processData : false,
					type : 'POST',
					success : function(data) {
						var parsed = JSON.parse(data);

						var response = $.post('/venues/save_playing_surface_pics/{{ venue.id }}', {
							'playing_surface_pics' : parsed['uploaded_files'],
							'playing_surface_details' : details.val()
						});

						response.done(function(data) {
							dfd.resolve();
							populateCarousel(parsed, $('#playing-surface-carousel'));
							$('#venue-playing-surface-details').html(details.val());
							$('.icon-eye-open').addClass('ready');
						});
					}
				});
			});
		});


		$('#save-video').click(function() {
			var textarea = $('#video form textarea'), dfd = saving($(this), $('.contents .alert'), 'Youtube video has been saved');

			var response = $.post('/venues/save_video/{{ venue.id }}', {
				'video' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-video').html(textarea.val());
				$('.icon-facetime-video').addClass('ready');
			});
		});

		$('#save-restroom-details').click(function() {
			var textarea = $('#restroom-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Restroom details has been saved');

			var response = $.post('/venues/save_restroom_details/{{ venue.id }}', {
				'restroom_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-restroom-details').html(textarea.val());
				$('.icon-female').addClass('ready');
			});
		});

		$('#save-concession-details').click(function() {
			var textarea = $('#concession-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Concession details has been saved');

			var response = $.post('/venues/save_concession_details/{{ venue.id }}', {
				'concession_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-concession-details').html(textarea.val());
				$('.icon-food').addClass('ready');
			});
		});

		$('#save-admission-details').click(function() {
			var textarea = $('#admission-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Admission details has been saved');

			var response = $.post('/venues/save_admission_details/{{ venue.id }}', {
				'admission_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-admission-details').html(textarea.val());
				$('.icon-ticket').addClass('ready');
			});
		});

		$('#save-shelter-details').click(function() {
			var textarea = $('#shelter-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Shelter details has been saved');

			var response = $.post('/venues/save_shelter_details/{{ venue.id }}', {
				'shelter_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-shelter-details').html(textarea.val());
				$('.icon-umbrella').addClass('ready');
			});
		});

		$('#save-medical-details').click(function() {
			var textareaDetails = $('#medical-details form textarea[name="details"]'), 
				address = $('#medical-details form input[name="address"]'), 
				city = $('#medical-details form input[name="city"]'), 
				state = $('#medical-details form select[name="state"]'), 
				zip = $('#medical-details form input[name="zip"]'), 
				dfd = saving($(this), $('.contents .alert'), 'Medical details has been saved');

			var medicalAddress = address.val() + ', ' + city.val() + ', ' + state.val() + ', ' + zip.val();

			var response = $.post('/venues/save_medical_details/{{ venue.id }}', {
				'medical_details' : textareaDetails.val(),
				'medical_address' : medicalAddress
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-medical-details').html(textareaDetails.val());
				$('#venue-medical-address').html(medicalAddress);
				$('.icon-medkit').addClass('ready');
			});
		});

		$('#save-handicap-details').click(function() {
			var textarea = $('#handicap-details form textarea'), dfd = saving($(this), $('.contents .alert'), 'Handicap details has been saved');

			var response = $.post('/venues/save_handicap_details/{{ venue.id }}', {
				'handicap_details' : textarea.val()
			});

			response.done(function() {
				dfd.resolve();
				$('#venue-handicap-details').html(textarea.val());
				$('.fa-wheelchair').addClass('ready');
			});
		});

		$('#save-location').click(function() {
			var dfd = saving($(this), $('.contents .alert'), 'Location has been saved');

			var response = $.post('/venues/save_coordinates/{{ venue.id }}', {
				'latitude' : '' + window.map.getCenter().lat(),
				'longitude' : '' +  window.map.getCenter().lng()
			});

			response.done(function() {
				dfd.resolve();
				$('.buttons i.icon-map-marker').addClass('ready initialized');
			});
		});

		$('#prize-this-venue').click(function() {
			var priceInput = $('#price'), button = $(this), currentPrice = $('#current-price');

			currentPrice.hide();

			if ($(this).html() == 'Save') {
				var dfd = saving($(this), $(this).parent().find('.alert'), 'Price saved');
				var response = $.post('/venues/save_price/{{ venue.id }}', {
					'price' : priceInput.val() ? priceInput.val() : '0'
				});

				response.done(function() {
					dfd.resolve();
					$(button).html('Price this Venue');
					currentPrice.show();
					priceInput.parent().css('display', 'none');
				});

			} else {
				priceInput.parent().css('display', 'table');
				$(this).html('Save');
			}
		});

	}); 
</script>
{% endblock scripts %}
